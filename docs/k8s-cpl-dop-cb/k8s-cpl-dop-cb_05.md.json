["```\n$ git clone https://github.com/k8sdevopscookbook/src.git\n$ cd chapter5\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n name: aws-gp2\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n type: gp2\n fsType: ext4 \nreclaimPolicy: Retain\nallowVolumeExpansion: true\nmountOptions:\n - debug\nvolumeBindingMode: Immediate\nEOF\n```", "```\n$ kubectl get sc\nNAME                      PROVISIONER                    AGE\naws-gp2                   kubernetes.io/aws-ebs          8s\ndefault                   kubernetes.io/aws-ebs          25h\ngp2 (default)             kubernetes.io/aws-ebs          25h\nopenebs-hostpath          openebs.io/local               175m\nopenebs-jiva-default      openebs.io/provisioner-iscsi   175m\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n name: aws-io1-slow\n annotations:\n storageclass.kubernetes.io/is-default-class: \"true\"\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n type: io1\n iopsPerGB: \"10\"\n fsType: ext4\nreclaimPolicy: Retain\nallowVolumeExpansion: true\nEOF\n```", "```\n$ kubectl get sc\nNAME                   PROVISIONER           AGE\naws-gp2                kubernetes.io/aws-ebs 6m28s\naws-io1-slow (default) kubernetes.io/aws-ebs 4m29s\n```", "```\n$ kubectl patch storageclass aws-io1-slow -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"false\"}}}'\n```", "```\n$ kubectl patch storageclass aws-gp2 -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"}}}'\n```", "```\n$ kubectl get sc\nNAME               PROVISIONER           AGE\naws-gp2 (default)  kubernetes.io/aws-ebs 10m\naws-io1-slow       kubernetes.io/aws-ebs 8m\n```", "```\n$ aws ec2 create-volume --availability-zone=us-west-2a --size=10 --volume-type=gp2\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Pod\nmetadata:\n name: test-server\nspec:\n containers:\n - image: gcr.io/google_containers/test-webserver\n name: test-container\n volumeMounts:\n - mountPath: /test-ebs\n name: test-volume\n volumes:\n - name: test-volume\n awsElasticBlockStore:\n volumeID: vol-02f4bc9b938604f72\n fsType: ext4\nEOF\n```", "```\n$ kubectl get pods\nNAME        READY STATUS  RESTARTS AGE\ntest-server 1/1   Running 0        4m32s\n```", "```\n...\n  volumeClaimTemplates:\n  - metadata:\n      name: datadir\n      annotations:\n        volume.beta.kubernetes.io/storage-class: aws-gp2\n    spec:\n      accessModes: [ \"ReadWriteOnce\" ]\n      resources:\n        requests:\n          storage: 1G\n...\n```", "```\n$ cat aws/redis-statefulset.yml\n```", "```\n$ kubectl apply -f aws/redis-statefulset.yml\n```", "```\n$ kubectl get pods\nNAME READY STATUS  RESTARTS AGE\nrd-0 1/1   Running 0        9m9s\nrd-1 1/1   Running 0        7m56s\nrd-2 1/1   Running 0        6m47s\n```", "```\n$ kubectl get pvc,pv\nNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE\ndatadir-rd-0 Bound pvc-8a538aa3-7382-4147-adde-1ea3dbaaafb4 1Gi RWO aws-gp2 10m\ndatadir-rd-1 Bound pvc-171fbee3-39bf-4450-961f-6c1417ff3897 1Gi RWO aws-gp2 9m1s\ndatadir-rd-2 Bound pvc-b40df89b-5349-4f02-8510-917012579746 1Gi RWO aws-gp2 7m52s$ \nNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE\npvc-171fbee3-39bf-4450-961f-6c1417ff3897 1Gi RWO Retain Bound default/datadir-rd-1 aws-gp2 9m18s\npvc-8a538aa3-7382-4147-adde-1ea3dbaaafb4 1Gi RWO Retain Bound default/datadir-rd-0 aws-gp2 10m\npvc-b40df89b-5349-4f02-8510-917012579746 1Gi RWO Retain Bound default/datadir-rd-2 aws-gp2 8m10s\n```", "```\n$ kubectl delete -f redis-statefulset.yml\n```", "```\n$ kubectl get pv\nNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE\npvc-171fbee3-39bf-4450-961f-6c1417ff3897 1Gi RWO Retain Bound default/datadir-rd-1 aws-gp2 13m\npvc-8a538aa3-7382-4147-adde-1ea3dbaaafb4 1Gi RWO Retain Bound default/datadir-rd-0 aws-gp2 15m\npvc-b40df89b-5349-4f02-8510-917012579746 1Gi RWO Retain Bound default/datadir-rd-2 aws-gp2 12m\n```", "```\n$ kubectl delete pvc datadir-rd-0 datadir-rd-1 datadir-rd-2\n```", "```\n$ kubectl delete pv <pv-name-1> <pv-name-2> <pv-name-3>\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Secret\nmetadata:\n name: aws-secret\n namespace: kube-system\nstringData:\n key_id: \"YOUR_KEY_ID_HERE\"\n access_key: \"YOUR_ACCESS_KEY_HERE\"\nEOF\n```", "```\n$ kubectl apply -k \"github.com/kubernetes-sigs/aws-ebs-csi-driver/deploy/kubernetes/overlays/stable/?ref=master\"\n```", "```\n$ kubectl get pods -n kube-system | grep ebs-csi\nebs-csi-controller-8579f977f4-ljfhm 4/4 Running 0 2m37s\nebs-csi-controller-8579f977f4-qw6ld 4/4 Running 0 2m37s\nebs-csi-node-5x8nh 3/3 Running 0 2m37s\nebs-csi-node-cfghj 3/3 Running 0 2m37s\nebs-csi-node-xp569 3/3 Running 0 2m37s\nebs-csi-node-z45hn 3/3 Running 0 2m37s\n```", "```\n$ cat <<EOF | kubectl apply -f -\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n name: aws-csi-ebs\nprovisioner: ebs.csi.aws.com\nvolumeBindingMode: WaitForFirstConsumer\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n name: csi-ebs-pvc\nspec:\n accessModes:\n - ReadWriteOnce\n storageClassName: aws-csi-ebs\n resources:\n requests:\n storage: 4Gi\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Pod\nmetadata:\n name: app\nspec:\n containers:\n - name: app\n image: centos\n command: [\"/bin/sh\"]\n args: [\"-c\", \"while true; do echo $(date -u) >> /data/out.txt; sleep 5; done\"]\n volumeMounts:\n - name: persistent-storage\n mountPath: /data\n volumes:\n - name: persistent-storage\n persistentVolumeClaim:\n claimName: csi-ebs-pvc\nEOF\n```", "```\n$ kubectl exec -it mytestapp cat /data/out.txt\nMon Sep 9 17:40:25 UTC 2019\n```", "```\n$ kubectl delete pod mytestapp && kubectl delete pvc csi-ebs-pvc\n```", "```\n$ git clone https://github.com/k8sdevopscookbook/src.git\n$ cd src/chapter5\n```", "```\n$ kubectl get sc\nNAME               PROVISIONER          AGE\nstandard (default) kubernetes.io/gce-pd 81s\n```", "```\n$ kubectl describe sc standard\nName: standard\nIsDefaultClass: Yes\nAnnotations: storageclass.beta.kubernetes.io/is-default-class=true\nProvisioner: kubernetes.io/gce-pd\nParameters: type=pd-standard\nAllowVolumeExpansion: <unset>\nMountOptions: <none>\nReclaimPolicy: Delete\nVolumeBindingMode: Immediate\nEvents: <none>\n```", "```\n$ cat <<EOF | kubectl apply -f -\nkind: StorageClass \napiVersion: storage.k8s.io/v1 \nmetadata:\n name: gce-pd \nprovisioner: kubernetes.io/gce-pd \nparameters:\n type: pd-standard\nvolumeBindingMode: WaitForFirstConsumer\nallowedTopologies:\n- matchLabelExpressions:\n - key: failure-domain.beta.kubernetes.io/zone\n values:\n - us-central1-a\n - us-central1-b\nEOF\n```", "```\n$ kubectl get sc\nNAME                      PROVISIONER                    AGE\ngce-pd                    kubernetes.io/gce-pd           3s\nstandard (default)        kubernetes.io/gce-pd           17m\n```", "```\n$ cat <<EOF | kubectl apply -f -\nkind: StorageClass \napiVersion: storage.k8s.io/v1 \nmetadata:\n name: gce-pd-ssd \n annotations:\n storageclass.kubernetes.io/is-default-class: \"true\"\nprovisioner: kubernetes.io/gce-pd \nparameters:\n type: pd-ssd\nreclaimPolicy: Retain\nallowVolumeExpansion: true\nvolumeBindingMode: WaitForFirstConsumer\nallowedTopologies:\n- matchLabelExpressions:\n - key: failure-domain.beta.kubernetes.io/zone\n values:\n - us-central1-a\n - us-central1-b\nEOF\n```", "```\n$ kubectl get sc\nNAME                 PROVISIONER AGE\ngce-pd               kubernetes.io/gce-pd 3m52s\ngce-pd-ssd (default) kubernetes.io/gce-pd 4s\nstandard (default)   kubernetes.io/gce-pd 21m\n```", "```\n$ kubectl patch storageclass standard -p '{\"metadata\": {\"annotations\":{\"storageclass.beta.kubernetes.io/is-default-class\":\"false\"}}}'\n$ kubectl patch storageclass gce-pd-ssd -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"false\"}}}'\n```", "```\n$ kubectl patch storageclass gce-pd -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"}}}'\n```", "```\n$ kubectl get sc\nNAME             PROVISIONER          AGE\ngce-pd (default) kubernetes.io/gce-pd 8m25s\ngce-pd-ssd       kubernetes.io/gce-pd 4m37s\nstandard         kubernetes.io/gce-pd 25m\n```", "```\n$ gcloud beta compute disks create gce-disk-1 --region us-central1 --replica-zones us-central1-b,us-central1-c \nCreated [https://www.googleapis.com/compute/beta/projects/devopscookbook/regions/us-central1/disks/gce-disk-1].\nNAME       ZONE SIZE_GB TYPE        STATUS\ngce-disk-1      500     pd-standard READY\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n name: gce-disk-1\nspec:\n storageClassName: \"\"\n capacity:\n storage: 500G\n accessModes:\n - ReadWriteOnce\n gcePersistentDisk:\n pdName: gce-disk-1\n fsType: ext4\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n name: pvc-gcedisk1\nspec:\n storageClassName: \"\"\n volumeName: gce-disk-1\n accessModes:\n - ReadWriteOnce\n resources:\n requests:\n storage: 500G\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Pod\nmetadata:\n name: test-server\nspec:\n containers:\n - image: gcr.io/google_containers/test-webserver\n name: test-container\n volumeMounts:\n - mountPath: /test-ebs\n name: test-volume\n volumes:\n - name: test-volume\n persistentVolumeClaim:\n claimName: pvc-gcedisk1\nEOF\n```", "```\n$ kubectl get pods\nNAME        READY STATUS  RESTARTS AGE\ntest-server 1/1   Running 0        4m32s\n```", "```\n...\n volumeClaimTemplates:\n - metadata:\n name: datadir\n annotations:\n volume.beta.kubernetes.io/storage-class: gce-pd\n spec:\n accessModes: [ \"ReadWriteOnce\" ]\n resources:\n requests:\n storage: 1G\n...\n```", "```\n$ cat gcp/redis-statefulset.yml\n```", "```\n$ kubectl apply -f redis-statefulset.yml\n```", "```\n$ kubectl get pods\nNAME READY STATUS  RESTARTS AGE\nrd-0 1/1   Running 0        2m27s\nrd-1 1/1   Running 0        81s\nrd-2 0/1   Running 0        19s\n```", "```\n$ kubectl get pvc, pv\nNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE\ndatadir-rd-0 Bound pvc-3481b73c-d347-11e9-b514-42010a80005e 1Gi RWO gce-pd 3m1s\ndatadir-rd-1 Bound pvc-5b8cc2d6-d347-11e9-b514-42010a80005e 1Gi RWO gce-pd 115s\ndatadir-rd-2 Bound pvc-80d826b9-d347-11e9-b514-42010a80005e 1Gi RWO gce-pd 53s\nNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE\npvc-3481b73c-d347-11e9-b514-42010a80005e 1Gi RWO Delete Bound default/datadir-rd-0 gce-pd 3m16s\npvc-5b8cc2d6-d347-11e9-b514-42010a80005e 1Gi RWO Delete Bound default/datadir-rd-1 gce-pd 2m11s\npvc-80d826b9-d347-11e9-b514-42010a80005e 1Gi RWO Delete Bound default/datadir-rd-2 gce-pd 68s\n```", "```\n$ kubectl delete -f redis-statefulset.yml\nstatefulset.apps \"rd\" deleted\nservice \"redis\" deleted\n```", "```\n$ kubectl get pv\nNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE\npvc-171fbee3-39bf-4450-961f-6c1417ff3897 1Gi RWO Retain Bound default/datadir-rd-1 aws-gp2 13m\npvc-8a538aa3-7382-4147-adde-1ea3dbaaafb4 1Gi RWO Retain Bound default/datadir-rd-0 aws-gp2 15m\npvc-b40df89b-5349-4f02-8510-917012579746 1Gi RWO Retain Bound default/datadir-rd-2 aws-gp2 12m\n```", "```\n$ kubectl delete pvc datadir-rd-0 datadir-rd-1 datadir-rd-2\n```", "```\n$ git clone https://github.com/kubernetes-sigs/gcp-compute-persistent-disk-csi-driver.git\n$ cd gcp-compute-persistent-disk-csi-driver/\n```", "```\n$ EXPORT PROJECT=\"DevOpsCookBook\"\n$ GCE_PD_SA_NAME=my-gce-pd-csi-sa \n$ GCE_PD_SA_DIR=/my/safe/credentials/directory \n$ ./deploy/setup-project.sh\n```", "```\n$ GCE_PD_SA_DIR=/my/safe/credentials/directory\n$ GCE_PD_DRIVER_VERSION=stable\n$ ./deploy/kubernetes/deploy-driver.sh\n```", "```\n$ kubectl get pods -n kube-system | grep ebs-csi\ncsi-gce-pd-controller   4/4 Running 0 31s\ncsi-gce-pd-node-f8w8w   3/3 Running 0 31s\ncsi-gce-pd-node-g8qn5   3/3 Running 0 31s\ncsi-gce-pd-node-n2fhp   3/3 Running 0 31s\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n name: gcp-csi-pd\nprovisioner: pd.csi.storage.gke.io\nparameters:\n type: pd-standard\n replication-type: regional-pd\nvolumeBindingMode: WaitForFirstConsumer\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n name: csi-gcp-pd-pvc\nspec:\n accessModes:\n - ReadWriteOnce\n storageClassName: gcp-csi-pd\n resources:\n requests:\n storage: 4Gi\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Pod\nmetadata:\n name: mytestapp\nspec:\n containers:\n - name: app\n image: centos\n command: [\"/bin/sh\"]\n args: [\"-c\", \"while true; do echo $(date -u) >> /data/out.txt; sleep 5; done\"]\n volumeMounts:\n - name: persistent-storage\n mountPath: /data\n volumes:\n - name: persistent-storage\n persistentVolumeClaim:\n claimName: csi-gcp-pd-pvc\nEOF\n```", "```\n$ kubectl exec -it mytestapp cat /data/out.txt\nMon Sep 9 18:20:38 UTC 2019\n```", "```\n$ kubectl delete pod mytestapp && kubectl delete pvc csi-gcp-pd-pvc \n```", "```\n$ git clone https://github.com/k8sdevopscookbook/src.git\n$ cd src/chapter5\n```", "```\n$ kubectl get sc\nNAME PROVISIONER AGE\ndefault (default) kubernetes.io/azure-disk 13m\nmanaged-premium kubernetes.io/azure-disk 13m\n```", "```\n$ kubectl describe sc default\nName: default\nIsDefaultClass: Yes\n...\nProvisioner: kubernetes.io/azure-disk\nParameters: cachingmode=ReadOnly,kind=Managed,storageaccounttype=Standard_LRS\nAllowVolumeExpansion: <unset>\nMountOptions: <none>\nReclaimPolicy: Delete\nVolumeBindingMode: Immediate\nEvents: <none>\n```", "```\n$ cat <<EOF | kubectl apply -f -\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n name: azure-zrs\nprovisioner: kubernetes.io/azure-disk\nparameters:\n storageaccounttype: Standard_ZRS\n kind: Shared\nreclaimPolicy: Retain\nallowVolumeExpansion: true\nvolumeBindingMode: Immediate\nEOF\n```", "```\n$ kubectl get sc\nNAME              PROVISIONER              AGE\nazure-zrs         kubernetes.io/azure-disk 4s\ndefault (default) kubernetes.io/azure-disk 18m\nmanaged-premium   kubernetes.io/azure-disk 18m\n```", "```\n$ kubectl patch storageclass default -p '{\"metadata\": {\"annotations\":{\"storageclass.beta.kubernetes.io/is-default-class\":\"false\"}}}'\n```", "```\n$ kubectl patch storageclass azure-zrs -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"}}}'\n```", "```\n$ kubectl get sc\nNAME                PROVISIONER AGE\nazure-zrs (default) kubernetes.io/azure-disk 4m38s\ndefault             kubernetes.io/azure-disk 23m\nmanaged-premium     kubernetes.io/azure-disk 23m\n```", "```\n...\n  volumeClaimTemplates:\n  - metadata:\n      name: datadir\n      annotations:\n        volume.beta.kubernetes.io/storage-class: azure-zrs\n    spec:\n      accessModes: [ \"ReadWriteOnce\" ]\n      resources:\n        requests:\n          storage: 1G\n...\n```", "```\n$ cat azure/redis-statefulset.yml\n```", "```\n$ kubectl apply -f redis-statefulset.yml\n```", "```\n$ kubectl get pods\nNAME READY STATUS  RESTARTS AGE\nrd-0 1/1   Running 0        6m24s\nrd-1 1/1   Running 0        4m14s\nrd-2 1/1   Running 0        2m13s\n```", "```\n$ kubectl get pvc, pv\nNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE\ndatadir-rd-0 Bound pvc-afaafb97-d376-11e9-88a2-a2c82783dcda 1Gi RWO azure-zrs 4m31s\ndatadir-rd-1 Bound pvc-fc9f3a35-d376-11e9-88a2-a2c82783dcda 1Gi RWO azure-zrs 2m22s\ndatadir-rd-2 Bound pvc-453d185d-d377-11e9-88a2-a2c82783dcda 1Gi RWO azure-zrs 20s\nNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE\npvc-453d185d-d377-11e9-88a2-a2c82783dcda 1Gi RWO Delete Bound default/datadir-rd-2 azure-zrs 22s\npvc-afaafb97-d376-11e9-88a2-a2c82783dcda 1Gi RWO Delete Bound default/datadir-rd-0 azure-zrs 4m42s\npvc-fc9f3a35-d376-11e9-88a2-a2c82783dcda 1Gi RWO Delete Bound default/datadir-rd-1 azure-zrs 2m38s\n```", "```\n$ kubectl delete -f redis-statefulset.yml\nstatefulset.apps \"rd\" deleted\nservice \"redis\" deleted\n```", "```\n$ kubectl get pv\nNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE\npvc-171fbee3-39bf-4450-961f-6c1417ff3897 1Gi RWO Retain Bound default/datadir-rd-1 aws-gp2 13m\npvc-8a538aa3-7382-4147-adde-1ea3dbaaafb4 1Gi RWO Retain Bound default/datadir-rd-0 aws-gp2 15m\npvc-b40df89b-5349-4f02-8510-917012579746 1Gi RWO Retain Bound default/datadir-rd-2 aws-gp2 12m\n```", "```\n$ kubectl delete pvc datadir-rd-0 datadir-rd-1 datadir-rd-2\n```", "```\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/azuredisk-csi-driver/master/deploy/crd-csi-driver-registry.yaml\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/azuredisk-csi-driver/master/deploy/crd-csi-node-info.yaml\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/azuredisk-csi-driver/master/deploy/rbac-csi-azuredisk-controller.yaml\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/azuredisk-csi-driver/master/deploy/csi-azuredisk-controller.yaml\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/azuredisk-csi-driver/master/deploy/csi-azuredisk-node.yaml\n```", "```\n$ kubectl get po -o wide -n kube-system | grep csi-azuredisk\ncsi-azuredisk-controller-9bc7f4d77-cbgxs 6/6 Running 0 5m31s 10.244.2.4 aks-agentpool-40109510-2 <none> <none>\ncsi-azuredisk-node-7kqzm 3/3 Running 0 5m27s 10.240.0.5 aks-agentpool-40109510-1 <none> <none>\ncsi-azuredisk-node-gm6dr 3/3 Running 0 5m27s 10.240.0.4 aks-agentpool-40109510-2 <none> <none>\ncsi-azuredisk-node-wqsls 3/3 Running 0 5m27s 10.240.0.6 aks-agentpool-40109510-0 <none> <none>\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n name: disk.csi.azure.com\nprovisioner: disk.csi.azure.com\nparameters:\n skuname: Standard_LRS \n kind: managed \n cachingMode: ReadOnly\nreclaimPolicy: Delete\nvolumeBindingMode: Immediate\nEOF\n```", "```\ncat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n name: csi-azure-pvc\nspec:\n accessModes:\n - ReadWriteOnce\n storageClassName: disk.csi.azure.com\n resources:\n requests:\n storage: 4Gi\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Pod\nmetadata:\n name: mytestapp\nspec:\n containers:\n - name: app\n image: centos\n command: [\"/bin/sh\"]\n args: [\"-c\", \"while true; do echo $(date -u) >> /data/out.txt; sleep 5; done\"]\n volumeMounts:\n - name: persistent-storage\n mountPath: /data\n volumes:\n - name: persistent-storage\n persistentVolumeClaim:\n claimName: csi-azure-pvc\nEOF\n```", "```\n$ kubectl exec -it mytestapp cat /data/out.txt\nMon Sep 9 19:23:29 UTC 2019\n```", "```\n$ git clone https://github.com/rook/rook.git\n$ cd rook/cluster/examples/kubernetes/ceph/\n```", "```\n$ kubectl create -f common.yaml \n$ kubectl create -f operator.yaml \n```", "```\n$ kubectl get pod -n rook-ceph\nNAME                                READY STATUS  RESTARTS AGE\nrook-ceph-operator-6b66859964-vnrfx 1/1   Running 0        2m12s\nrook-discover-8snpm                 1/1   Running 0        97s\nrook-discover-mcx9q                 1/1   Running 0        97s\nrook-discover-mdg2s                 1/1   Running 0        97s\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: ceph.rook.io/v1\nkind: CephCluster\nmetadata:\n name: rook-ceph\n namespace: rook-ceph\nspec:\n cephVersion:\n image: ceph/ceph:v14.2.3-20190904\n dataDirHostPath: /var/lib/rook\n mon:\n count: 3\n dashboard:\n enabled: true\n storage:\n useAllNodes: true\n useAllDevices: false\n directories:\n - path: /var/lib/rook\nEOF\n```", "```\n$ kubectl get pod -n rook-ceph\n```", "```\n$ kubectl apply -f toolbox.yaml\n```", "```\n$ kubectl -n rook-ceph get pod -l \"app=rook-ceph-tools\"\nNAME                             READY STATUS  RESTARTS AGE\nrook-ceph-tools-6fdfc54b6d-4kdtm 1/1   Running 0        109s\n```", "```\n$ kubectl -n rook-ceph exec -it $(kubectl -n rook-ceph get pod -l \"app=rook-ceph-tools\" -o jsonpath='{.items[0].metadata.name}') bash\n```", "```\n# ceph status\n cluster:\n id: 6b6e4bfb-bfef-46b7-94bd-9979e5e8bf04\n health: HEALTH_OK\n services:\n mon: 3 daemons, quorum a,b,c (age 12m)\n mgr: a(active, since 12m)\n osd: 3 osds: 3 up (since 11m), 3 in (since 11m)\n data:\n pools: 0 pools, 0 pgs\n objects: 0 objects, 0 B\n usage: 49 GiB used, 241 GiB / 291 GiB avail\n pgs:\n```", "```\n$ kubectl -n rook-ceph delete deployment rook-ceph-tools\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: ceph.rook.io/v1\nkind: CephBlockPool\nmetadata:\n name: replicapool\n namespace: rook-ceph\nspec:\n failureDomain: host\n replicated:\n size: 3\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n name: rook-ceph-block\nprovisioner: rook-ceph.rbd.csi.ceph.com\nparameters:\n clusterID: rook-ceph\n pool: replicapool\n imageFormat: \"2\"\n imageFeatures: layering\n csi.storage.k8s.io/provisioner-secret-name: rook-ceph-csi\n csi.storage.k8s.io/provisioner-secret-namespace: rook-ceph\n csi.storage.k8s.io/node-stage-secret-name: rook-ceph-csi\n csi.storage.k8s.io/node-stage-secret-namespace: rook-ceph\n csi.storage.k8s.io/fstype: xfs\nreclaimPolicy: Delete\nEOF\n```", "```\n$ kubectl get sc\nNAME              PROVISIONER                AGE\ndefault (default) kubernetes.io/azure-disk   6h27m\nrook-ceph-block   rook-ceph.rbd.csi.ceph.com 3s\n```", "```\n$ git clone https://github.com/k8sdevopscookbook/src.git\n$ cd src/chapter5/rook/\n```", "```\n$ cat mysql.yaml && cat wordpress.yaml\n```", "```\n$ kubectl apply -f mysql.yaml \n$ kubectl apply -f wordpress.yaml\n```", "```\n$ kubectl get pv\nNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE\npvc-eb2d23b8-d38a-11e9-88a2-a2c82783dcda 20Gi RWO Delete Bound default/mysql-pv-claim rook-ceph-block 38s\npvc-eeab1ebc-d38a-11e9-88a2-a2c82783dcda 20Gi RWO Delete Bound default/wp-pv-claim rook-ceph-block 38s\n```", "```\n$ kubectl get service\nNAME            TYPE         CLUSTER-IP  EXTERNAL-IP  PORT(S)      AGE\nkubernetes      ClusterIP    10.0.0.1    <none>       443/TCP      6h34m\nwordpress       LoadBalancer 10.0.102.14 13.64.96.240 80:30596/TCP 3m36s\nwordpress-mysql ClusterIP    None        <none>       3306/TCP     3m42s\n```", "```\n$ sudo apt-get update && sudo apt-get install open-iscsi && sudo service open-iscsi restart\n```", "```\n$ systemctl status iscsid\n\u25cf iscsid.service - iSCSI initiator daemon (iscsid)\n Loaded: loaded (/lib/systemd/system/iscsid.service; enabled; vendor preset: enabled)\n Active: active (running) since Sun 2019-09-08 07:40:43 UTC; 7s ago\n Docs: man:iscsid(8)\n```", "```\n$ sudo systemctl enable iscsid && sudo systemctl start iscsid\n```", "```\n$ kubectl apply -f https://openebs.github.io/charts/openebs-operator.yaml\n```", "```\n$ kubectl get pods --namespace openebs\nNAME                                        READY STATUS  RESTARTS AGE\nmaya-apiserver-dcbc87f7f-k99fz              0/1   Running 0        88s\nopenebs-admission-server-585c6588d-j29ng    1/1   Running 0        88s\nopenebs-localpv-provisioner-cfbd49877-jzjxl 1/1   Running 0        87s\nopenebs-ndm-fcss7                           1/1   Running 0        88s\nopenebs-ndm-m4qm5                           1/1   Running 0        88s\nopenebs-ndm-operator-bc76c6ddc-4kvxp        1/1   Running 0        88s\nopenebs-ndm-vt76c                           1/1   Running 0        88s\nopenebs-provisioner-57bbbd888d-jb94v        1/1   Running 0        88s\nopenebs-snapshot-operator-7dd598c655-2ck74  2/2   Running 0        88s\n```", "```\n$ kubectl get sc\nNAME                      PROVISIONER                                              AGE\nopenebs-device            openebs.io/local                                         25m\nopenebs-hostpath          openebs.io/local                                         25m\nopenebs-jiva-default      openebs.io/provisioner-iscsi                             25m\nopenebs-snapshot-promoter volumesnapshot.external-storage.k8s.io/snapshot-promoter 25m\n```", "```\n$ kubectl describe sc openebs-jiva-default\nName: openebs-jiva-default\nIsDefaultClass: No\nAnnotations: cas.openebs.io/config=- name: ReplicaCount\n value: \"3\"\n- name: StoragePool\n value: default\n```", "```\n$ cat <<EOF | kubectl apply -f -\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n name: demo-vol1-claim\nspec:\n storageClassName: openebs-jiva-default\n accessModes:\n - ReadWriteOnce\n resources:\n requests:\n storage: 5G\nEOF\n```", "```\n$ kubectl get pvc\nNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE\ndemo-vol1-claim Bound pvc-cb7485bc-6d45-4814-adb1-e483c0ebbeb5 5G RWO openebs-jiva-default 4s\n```", "```\n$ kubectl apply -f https://raw.githubusercontent.com/openebs/openebs/master/k8s/demo/percona/percona-openebs-deployment.yaml\n```", "```\n$ kubectl get pods\nNAME                                                          READY STATUS  RESTARTS AGE\npercona-767db88d9d-2s8np                                      1/1   Running 0        75s\npvc-cb7485bc-6d45-4814-adb1-e483c0ebbeb5-ctrl-54d7fd794-s8svt 2/2   Running 0        2m23s\npvc-cb7485bc-6d45-4814-adb1-e483c0ebbeb5-rep-647458f56f-2b9q4 1/1   Running 1        2m18s\npvc-cb7485bc-6d45-4814-adb1-e483c0ebbeb5-rep-647458f56f-nkbfq 1/1   Running 0        2m18s\npvc-cb7485bc-6d45-4814-adb1-e483c0ebbeb5-rep-647458f56f-x7s9b 1/1   Running 0        2m18s\n```", "```\n$ kubectl get blockdevices -n openebs\nNAME NODENAME SIZE CLAIMSTATE STATUS AGE\nblockdevice-24d9b7652893384a36d0cc34a804c60c ip-172-23-1-176.us-west-2.compute.internal 107374182400 Unclaimed Active 52s\nblockdevice-8ef1fd7e30cf0667476dba97975d5ac9 ip-172-23-1-25.us-west-2.compute.internal 107374182400 Unclaimed Active 51s\nblockdevice-94e7c768ef098a74f3e2c7fed6d82a5f ip-172-23-1-253.us-west-2.compute.internal 107374182400 Unclaimed Active 52s\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: openebs.io/v1alpha1\nkind: StoragePoolClaim\nmetadata:\n name: cstor-disk-pool\n annotations:\n cas.openebs.io/config: |\n - name: PoolResourceRequests\n value: |-\n memory: 2Gi\n - name: PoolResourceLimits\n value: |-\n memory: 4Gi\nspec:\n name: cstor-disk-pool\n type: disk\n poolSpec:\n poolType: striped\n blockDevices:\n blockDeviceList:\n - blockdevice-24d9b7652893384a36d0cc34a804c60c\n - blockdevice-8ef1fd7e30cf0667476dba97975d5ac9\n - blockdevice-94e7c768ef098a74f3e2c7fed6d82a5f\nEOF\n```", "```\n$ kubectl get spc\nNAME AGE\ncstor-disk-pool 29s\n```", "```\n$ kubectl get csp\nNAME                 ALLOCATED FREE  CAPACITY STATUS  TYPE    AGE\ncstor-disk-pool-8fnp 270K      99.5G 99.5G    Healthy striped 3m9s\ncstor-disk-pool-nsy6 270K      99.5G 99.5G    Healthy striped 3m9s\ncstor-disk-pool-v6ue 270K      99.5G 99.5G    Healthy striped 3m10s\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n name: openebs-cstor-default\n annotations:\n openebs.io/cas-type: cstor\n cas.openebs.io/config: |\n - name: StoragePoolClaim\n value: \"cstor-disk-pool\"\n - name: ReplicaCount\n value: \"3\"\nprovisioner: openebs.io/provisioner-iscsi\nEOF\n```", "```\n$ kubectl get sc\nNAME                  PROVISIONER                  AGE\ndefault               kubernetes.io/aws-ebs        25m\ngp2 (default)         kubernetes.io/aws-ebs        25m\nopenebs-cstor-default openebs.io/provisioner-iscsi 6s\nopenebs-device        openebs.io/local             20m\nopenebs-hostpath      openebs.io/local             20m\nopenebs-jiva-default  openebs.io/provisioner-iscsi 20m\nopenebs-snapshot-promoter volumesnapshot.external-storage.k8s.io/snapshot-promoter 20m\nubun\n```", "```\n$ kubectl patch storageclass gp2 -p '{\"metadata\": {\"annotations\":{\"storageclass.beta.kubernetes.io/is-default-class\":\"false\"}}}'\n```", "```\n$ kubectl patch storageclass openebs-cstor-default -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"}}}'\n```", "```\n$ git clone https://github.com/k8sdevopscookbook/src.git\n$ cd src/chapter5/openebs/\n```", "```\n$ kubectl apply -f minio.yaml\ndeployment.apps/minio-deployment created\npersistentvolumeclaim/minio-pv-claim created\nservice/minio-service created\n```", "```\n$ kubectl get service\nNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE\nkubernetes ClusterIP 10.3.0.1 <none> 443/TCP 54m\nminio-service LoadBalancer 10.3.0.29 adb3bdaa893984515b9527ca8f2f8ca6-1957771474.us-west-2.elb. amazonaws.com 9000:32701/TCP 3s\n```", "```\napiVersion: openebs.io/v1alpha1\nkind: StoragePool\nmetadata:\n  name: my-pool\n  type: hostdir\nspec:\n  path: \"/my/openebs/folder\"\n```", "```\n$ sudo apt install -y nfs-common\n```", "```\n$ yum install nfs-utils\n```", "```\n$ git clone https://github.com/rook/rook.git\n$ cd rook/cluster/examples/kubernetes/nfs/\n```", "```\n$ kubectl create -f operator.yaml\n```", "```\n$ kubectl get pods -n rook-nfs-system\nNAME READY STATUS RESTARTS AGE\nrook-nfs-operator-54cf68686c-f66f5 1/1 Running 0 51s\nrook-nfs-provisioner-79fbdc79bb-hf9rn 1/1 Running 0 51s\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Namespace\nmetadata:\n name: rook-nfs\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n name: nfs-default-claim\n namespace: rook-nfs\nspec:\n accessModes:\n - ReadWriteMany\n resources:\n requests:\n storage: 1Gi\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: nfs.rook.io/v1alpha1\nkind: NFSServer\nmetadata:\n name: rook-nfs\n namespace: rook-nfs\nspec:\n serviceAccountName: rook-nfs\n replicas: 1\n exports:\n - name: share1\n server:\n accessMode: ReadWrite\n squash: \"none\"\n persistentVolumeClaim:\n claimName: nfs-default-claim\n annotations:\n # key: value\nEOF\n```", "```\n$ kubectl get pod -l app=rook-nfs -n rook-nfs \nNAME       READY  STATUS  RESTARTS AGE\nrook-nfs-0 1/1    Running 0        2m\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n labels:\n app: rook-nfs\n name: rook-nfs-share1\nparameters:\n exportName: share1\n nfsServerName: rook-nfs\n nfsServerNamespace: rook-nfs\nprovisioner: rook.io/nfs-provisioner\nreclaimPolicy: Delete\nvolumeBindingMode: Immediate\nEOF\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n name: rook-nfs-pv-claim\nspec:\n storageClassName: \"rook-nfs-share1\"\n accessModes:\n - ReadWriteMany\n resources:\n requests:\n storage: 1Mi\nEOF\n```", "```\n$ git clone https://github.com/k8sdevopscookbook/src.git\n$ cd src/chapter5/openebs\n```", "```\n$ kubectl apply -f nfs\n```", "```\n$ kubectl get pvc\nNAME       STATUS VOLUME                                   CAPACITY ACCESS MODES STORAGECLASS         AGE\nopenebspvc Bound  pvc-9f70c0b4-efe9-4534-8748-95dba05a7327 110G     RWO          openebs-jiva-default 13m\n```", "```\n$ kubectl get sc\nNAME                            PROVISIONER                  AGE\nopenebs-cstor-default (default) openebs.io/provisioner-iscsi 14h\nopenebs-device                  openebs.io/local             15h\nopenebs-hostpath                openebs.io/local             15h\nopenebs-jiva-default            openebs.io/provisioner-iscsi 15h\nopenebs-nfs                     openebs.io/nfs               5s\nopenebs-snapshot-promoter       volumesnapshot.external-storage.k8s.io/snapshot-promoter 15h\n```", "```\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n name: openebs-nfs-pv-claim\nspec:\n storageClassName: \"openebs-nfs\"\n accessModes:\n - ReadWriteMany\n resources:\n requests:\n storage: 1Mi\nEOF\n```", "```\n$ kubectl get pvc\nNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE\nmysql-pv-claim Pending rook-ceph-block 28s\n```", "```\n$ kubectl describe pvc mysql-pv-claim\n...\nEvents:\n Type Reason Age From Message\n ---- ------ ---- ---- -------\n Warning ProvisioningFailed 3s (x16 over 3m42s) persistentvolume-controller storageclass.storage.k8s.io \"rook-ceph-block\" not found\n```", "```\n$ kubectl get sc\nNAME                             PROVISIONER                                              AGE\ndefault                          kubernetes.io/aws-ebs                                    102m\ngp2                              kubernetes.io/aws-ebs                                    102m\nopenebs-cstor-default (default)  openebs.io/provisioner-iscsi                             77m\nopenebs-device                   openebs.io/local                                         97m\nopenebs-hostpath                 openebs.io/local                                         97m\nopenebs-jiva-default             openebs.io/provisioner-iscsi                             97m\nopenebs-snapshot-promoter        volumesnapshot.external-storage.k8s.io/snapshot-promoter 97m\n```", "```\n$ kubectl get pvc\nNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE\nmysql-pv-claim Bound pvc-bbf2b01e-2a69-4c4c-b9c2-48921959c363 20Gi RWO openebs-cstor-default 5s\n```", "```\n$ kubectl get pv\nNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE\npvc-bbf2b01e-2a69-4c4c-b9c2-48921959c363 20Gi RWO Delete Terminating default/mysql-pv-claim gp2 7m45s\n```", "```\n$ kubectl edit pv <PV_Name>\n```"]