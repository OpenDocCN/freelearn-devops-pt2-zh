["```\n$ sudo pip install dopy\n```", "```\n$ mkdir digitalocean digitalocean/group_vars digitalocean/roles\n$ ansible-galaxy init digitalocean/roles/droplet\n$ touch digitalocean/production digitalocean/site.yml digitalocean/group_vars/common.yml\n```", "```\nansible-vault \\\n encrypt_string 'pLgVbM2hswiLFWbemyD4Nru3a2yYwAKm2xbL6WmPBtzqvnMTrVTXYuabWbp7vArQ' \\\n --name 'do_token'\n```", "```\n---\n# defaults file for digitalocean/roles/droplet\n\nkey:\n  name: \"Ansible\"\n  path: \"~/.ssh/id_rsa.pub\"\n\ndroplet:\n  name: \"AnsibleDroplet\"\n  region: \"lon1\"\n  size: \"s-1vcpu-2gb\"\n  image: \"centos-7-x64\"\n  timeout: \"500\"\n```", "```\n- name: \"upload SSH key to DigitalOcean\"\n  digital_ocean_sshkey:\n    oauth_token: \"{{ do_token }}\"\n    name: \"{{ key.name }}\"\n    ssh_pub_key: \"{{ item }}\"\n    state: present\n  with_file: \"{{ key.path }}\"\n```", "```\n- name: \"gather facts on all of the SSH keys in DigitalOcean\"\n  digital_ocean_sshkey_facts:\n    oauth_token: \"{{ do_token }}\"\n```", "```\n{\n    \"fingerprint\": \"9e:ad:42:e9:86:01:3c:5f:de:11:60:11:e0:11:9e:11\",\n    \"id\": 2663259,\n    \"name\": \"Work\",\n    \"public_key\": \"ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAv2cUTYCHnGcwHYjVh3vu09T6UwLEyXEKDnv3039KStLpQV3H7PvhOIpAbY7Gvxi1t2KyqkOvuBdIat5fdQKzGQMEFZiwlcgWDVQGJBKuMH02w+ceMqNYaD8sZqUO+bQQwkUDt3PuDKoyNRzhcDLsc//Dp6wAwJsw75Voe9bQecI3cWqjT54n+oareqADilQ/nO2cdFdmCEfVJP4CqOmL1QLJQNe46yQoGJWLNa9VPC8/ffmUPnwJRWa9AZRPAQ2vGbDF6meSsFwVUfhtxkn+0bof7PFxrcaycGa3zqt6m1y6o3BDh29eFN94TZf9lUK/nQrXuby2/FhrMBrRcgWE4gQ== russ@work\"\n},\n{\n    \"fingerprint\": \"7d:ce:56:5f:af:45:71:ab:af:fe:77:c2:9f:90:bc:cf\",\n    \"id\": 19646265,\n    \"name\": \"Ansible\",\n    \"public_key\": \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDmuoFR01i/Yf3HATl9c3sufJvghTFgYzK/Zt29JiTqWlSQhmXhNNTh6iI6nXuPVhQGQaciWbqya6buncQ3vecISx6+EwsAmY3Mwpz1a/eMiXOgO/zn6Uf79dXcMN2JwpLFoON1f9PR0/DTpEkjwqb+eNLw9ThjH0J994+Pev+m8OrqgReFW36a/kviUYKsHxkXmkgxtPJgwKU90STNab4qyfKEGhi2w/NzECgseeQYs1H3klORaHQybhpXkoCIMmgy9gnzSH7oa2mJqKilVed27xoirkXzWPaAQlfiEE1iup+2xMqWY6Jl9qb8tJHRS+l8UcxTMNaWsQkTysLTgBAZ russ@mckendrick.io\"\n}\n```", "```\n- name: \"set the SSH key ID as a fact\"\n  set_fact:\n    pubkey: \"{{ item.id }}\"\n  with_items: \"{{ ssh_keys | json_query(key_query) }}\"\n  vars:\n    key_query: \"[?name=='{{ key.name }}']\"\n```", "```\n- name: \"launch the droplet\"\n  digital_ocean:\n    state: \"present\"\n    command: \"droplet\"\n    name: \"{{ droplet.name }}\"\n    unique_name: \"yes\"\n    api_token: \"{{ do_token }}\"\n    size_id: \"{{ droplet.size }}\"\n    region_id: \"{{ droplet.region }}\"\n    image_id: \"{{ droplet.image }}\"\n    ssh_key_ids: [ \"{{ pubkey }}\" ]\n    wait_timeout: \"{{ droplet.timeout }}\"\n  register: droplet\n```", "```\n- name: \"set the droplet IP address as a fact\"\n  set_fact:\n    droplet_ip: \"{{ droplet.droplet.ip_address }}\"\n\n- name: \"print the IP address of the droplet\" \n  debug:\n    msg: \"The IP of the droplet is {{ droplet_ip }}\"\n```", "```\n---\n\n- hosts: localhost\n  connection: local\n  gather_facts: false\n\n  vars_files:\n    - group_vars/common.yml\n\n  roles:\n    - roles/droplet\n```", "```\n$ ansible-playbook --vault-id @prompt site.yml\n```", "```\nPLAY [localhost] *****************************************************************************************************************************\n\nTASK [roles/droplet : upload SSH key to DigitalOcean] ****************************************************************************************\nchanged: [localhost] => (item=ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDmuoFR01i/Yf3HATl9c3sufJvghTFgYzK/Zt29JiTqWlSQhmXhNNTh6iI6nXuPVhQGQaciWbqya6buncQ3vecISx6+EwsAmY3Mwpz1a/eMiXOgO/zn6Uf79dXcMN2JwpLFoON1f9PR0/DTpEkjwqb+eNLw9ThjH0J994+Pev+m8OrqgReFW36a/kviUYKsHxkXmkgxtPJgwKU90STNab4qyfKEGhi2w/NzECgseeQYs1H3klORaHQybhpXkoCIMmgy9gnzSH7oa2mJqKilVed27xoirkXzWPaAQlfiEE1iup+2xMqWY6Jl9qb8tJHRS+l8UcxTMNaWsQkTysLTgBAZ russ@mckendrick.io)\n\nTASK [roles/droplet : gather facts on all of the SSH keys in DigitalOcean] *******************************************************************\nok: [localhost]\n\nTASK [roles/droplet : set the SSH key ID as a fact] ******************************************************************************************\nok: [localhost] => (item={u'public_key': u'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDmuoFR01i/Yf3HATl9c3sufJvghTFgYzK/Zt29JiTqWlSQhmXhNNTh6iI6nXuPVhQGQaciWbqya6buncQ3vecISx6+EwsAmY3Mwpz1a/eMiXOgO/zn6Uf79dXcMN2JwpLFoON1f9PR0/DTpEkjwqb+eNLw9ThjH0J994+Pev+m8OrqgReFW36a/kviUYKsHxkXmkgxtPJgwKU90STNab4qyfKEGhi2w/NzECgseeQYs1H3klORaHQybhpXkoCIMmgy9gnzSH7oa2mJqKilVed27xoirkXzWPaAQlfiEE1iup+2xMqWY6Jl9qb8tJHRS+l8UcxTMNaWsQkTysLTgBAZ russ@mckendrick.io', u'fingerprint': u'7d:ce:56:5f:af:45:71:ab:af:fe:77:c2:9f:90:bc:cf', u'id': 19646265, u'name': u'Ansible'})\n\nTASK [roles/droplet : launch the droplet] ****************************************************************************************************\nchanged: [localhost]\n\nTASK [roles/droplet : set the droplet IP address as a fact] **********************************************************************************\nok: [localhost]\n\nTASK [roles/droplet : print the IP address of the droplet] ***********************************************************************************\nok: [localhost] => {\n \"msg\": \"The IP of the droplet is 159.65.27.87\"\n}\n\nPLAY RECAP ***********************************************************************************************************************************\nlocalhost : ok=6 changed=2 unreachable=0 failed=0\n```", "```\n[droplets]\n\n[digitalocean:children]\ndroplets\n\n[digitalocean:vars]\nansible_ssh_user=root\nansible_ssh_private_key_file=~/.ssh/id_rsa\nhost_key_checking=False\nansible_python_interpreter=/usr/bin/python\n```", "```\ndo_token: !vault |\n          $ANSIBLE_VAULT;1.1;AES256\n          63376236316336633631353131313363666463363834524609643522613230653265373236353664\n          36653763373961313433373138633933663939452257345733336238353862383432373831393839\n          32316262653963333836613332366639333039393066343739303066663262323337613937623533\n          3461626330663363330a303538393836613835313166383030636134623530323932303266373134\n          35616339376138636530346632345734563457326532376233323930383535303563323634336162\n          31386635646636363334393664383633346636616664386539393162333062343964326561343861\n          33613265616632656465643664376536653334653532336335306230363834523454245337626631\n          33323730636562616631\n\ndroplet:\n  name: \"WordPress\"\n  region: \"lon1\"\n  size: \"s-1vcpu-2gb\"\n  image: \"centos-7-x64\"\n  timeout: \"500\"\n\nwordpress:\n  domain: \"http://{{ hostvars['localhost'].droplet_ip }}/\"\n  title: \"WordPress installed by Ansible on {{ os_family }} host in DigitalOcean\"\n  username: \"ansible\"\n  password: \"AnsiblePasswordForDigitalOcean\"\n  email: \"test@example.com\"\n  theme: \"sydney\"\n  plugins:\n    - \"jetpack\"\n    - \"wp-super-cache\"\n    - \"wordpress-seo\"\n    - \"wordfence\"\n    - \"nginx-helper\"\n```", "```\n---\n\n- name: Launch the droplet in DigitalOcean\n  hosts: localhost\n  connection: local\n  gather_facts: True\n\n  vars_files:\n    - group_vars/common.yml\n\n  roles:\n    - roles/droplet\n\n- name: Install WordPress on the droplet\n  hosts: digitalocean\n  gather_facts: true\n\n  vars_files:\n    - group_vars/common.yml\n\n  roles:\n    - roles/stack-install\n    - roles/stack-config\n    - roles/wordpress\n```", "```\n- name: \"print the IP address of the droplet\" \n  debug:\n    msg: \"The IP of the droplet is {{ droplet_ip }}\"\n```", "```\n- name: add our droplet to a host group for use in the next step\n  add_host:\n    name: \"{{ droplet_ip }}\"\n    ansible_ssh_host: \"{{ droplet_ip }}\"\n    groups: \"droplets\"\n```", "```\n$ ansible-playbook -i production --vault-id @prompt site.yml\n```", "```\nRUNNING HANDLER [roles/stack-config : restart nginx] *****************************************************************************************\nchanged: [165.227.228.104]\n\nRUNNING HANDLER [roles/stack-config : restart php-fpm] ***************************************************************************************\nchanged: [165.227.228.104]\n\nPLAY RECAP ***********************************************************************************************************************************\n165.227.228.104 : ok=47 changed=37 unreachable=0 failed=0\nlocalhost : ok=7 changed=1 unreachable=0 failed=0\n```"]