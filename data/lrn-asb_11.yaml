- en: Building Out a VMware Deployment
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建VMware部署
- en: Now that we know how to launch networking and services in AWS, we will now discuss
    deploying a similar setup in a VMware environment and also talk through the core
    VMware modules.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道如何在AWS中启动网络和服务，我们现在将讨论在VMware环境中部署类似设置，并讨论核心VMware模块。
- en: 'In this chapter, we will:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将：
- en: Quickly introduce VMware
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 快速介绍VMware
- en: Review the Ansible VMware modules
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 审查Ansible VMware模块
- en: Work through an example playbook that launches several virtual machines
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过一个示例playbook来启动几个虚拟机
- en: Technical requirements
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: In this chapter, we are going to be discussing various components of the VMware
    family of products and how you can interact with them using Ansible. While there
    is an example playbook in this chapter, it may not be easily transferable to your
    installation. Because of this, it is not recommended that you use any of the examples
    in this chapter without first updating them.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论VMware产品系列的各种组件，以及如何使用Ansible与它们进行交互。虽然本章中有一个示例playbook，但它可能不容易转移到您的安装中。因此，建议您在更新之前不要使用本章中的任何示例。
- en: An introduction to VMware
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VMware简介
- en: VMware has a nearly 20-year history, from a stealth start-up to being owned
    by Dell and acquired by EMC, with a revenue of $7.92 billion. There are around
    30 products currently available in the VMware product portfolio; the most commonly
    known ones are its hypervisors, of which there are two different types.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: VMware有近20年的历史，从一个隐秘的初创公司到被戴尔拥有并被EMC收购，收入达79.2亿美元。VMware产品组合目前有大约30种产品；最常见的是其hypervisors，其中有两种不同的类型。
- en: The first hypervisor, VMware ESXi, is a type 1 that runs directly on hardware
    using the instruction sets found in most modern 64-bit Intel and AMD CPUs. Its
    original type 2 hypervisor does not require virtualization instructions to be
    present within the CPU like they need to be in type 1\. It was formally known
    as GSX; this hypervisor pre-dates the type 1 hypervisor, meaning that it can support
    much older CPUs.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个hypervisor，VMware ESXi，是一种直接在硬件上运行的类型1，使用大多数现代64位英特尔和AMD CPU中找到的指令集。其原始的类型2
    hypervisor不需要CPU中存在虚拟化指令，就像它们需要在类型1中一样。它以前被称为GSX；这个hypervisor早于类型1 hypervisor，这意味着它可以支持更旧的CPU。
- en: VMware is extremely commonplace in most enterprises; it allows administrators
    to quickly deploy virtual machines across numerous standard x86-based hardware
    configurations and types.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: VMware在大多数企业中非常普遍；它允许管理员快速在许多标准的基于x86的硬件配置和类型上部署虚拟机。
- en: The VMware modules
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VMware模块
- en: As already mentioned, there are around 30 products in the VMware range; these
    cover everything from hypervisors to virtual switches, virtual storage, and several
    interfaces for interacting with your VMware-based hosts and virtual machines.
    In this section, we will cover the core modules that ship with Ansible to manage
    all aspects of your VMware estate.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，VMware范围内大约有30种产品；这些产品涵盖了从hypervisors到虚拟交换机、虚拟存储以及与基于VMware的主机和虚拟机进行交互的几个接口。在本节中，我们将介绍随Ansible一起提供的核心模块，以管理您的VMware资产的所有方面。
- en: I have tried to split them into logical groups and, for each of the groups,
    will give a brief explanation of the product the modules are targeting.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我尝试将它们分成逻辑组，并且对于每个组，都会简要解释模块所针对的产品。
- en: Requirements
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 要求
- en: 'The modules all have one thing in common: they all require a Python module
    called `PyVmomi` to be installed. To install this, run the following `pip` command:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 所有模块都有一个共同点：它们都需要安装一个名为`PyVmomi`的Python模块。要安装它，请运行以下`pip`命令：
- en: '[PRE0]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This module contains the VMware vSphere API Python bindings, and without it,
    the modules we are going to cover in this chapter will not be able to interact
    with your VMware installation.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块包含了VMware vSphere API Python绑定，没有它，我们将在本章中要讨论的模块无法与您的VMware安装进行交互。
- en: While the modules in this chapter have been tested with vSphere 5.5 to 6.5,
    you may find that some of the older modules have some problems with newer versions
    of vSphere.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然本章中的模块已经在vSphere 5.5到6.5上进行了测试，但您可能会发现一些旧模块在较新版本的vSphere上存在一些问题。
- en: vCloud Air
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vCloud Air
- en: vCloud Air was VMware's **Infrastructure as a Service** (**IaaS**) offering,
    I say *was* because the vCloud Air business unit and the team responsible for
    the service was acquired by French hosting and cloud company OVH from VMware in
    mid-2017\. There are three Ansible modules which offer direct support for vCloud
    Air, as well as **VMware vCloud Hybrid Service** (**vCHS**) and **VMware vCloud
    Director** (**vCD**).
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: vCloud Air是VMware的**基础设施即服务**（**IaaS**）产品，我说*是*因为vCloud Air业务部门和负责该服务的团队于2017年中被法国托管和云公司OVH从VMware收购。有三个Ansible模块直接支持vCloud
    Air，以及**VMware vCloud Hybrid Service**（**vCHS**）和**VMware vCloud Director**（**vCD**）。
- en: The vca_fw module
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vca_fw模块
- en: 'This module enables you to add and remove firewall rules from a vCloud Air
    gateway. The following example shows you how to add a rule allowing SSH traffic:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块使您能够从vCloud Air网关中添加和删除防火墙规则。以下示例向您展示了如何添加一个允许SSH流量的规则：
- en: '[PRE1]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Notice how we are passing a `service_type`; this could be `vca`, `vcd`, or `vchs`.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 注意我们传递了一个`service_type`；这可以是`vca`、`vcd`或`vchs`。
- en: The vca_nat module
  id: totrans-26
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vca_nat模块
- en: 'This module allows you to manage the **network address translation** (**NAT**)
    rules. In the following example, we are asking all traffic that hits port `2222`
    on the public IP address of `123.123.123.123` to be forwarded to port `22` on
    the virtual machine with an IP address of `192.0.10.20`:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块允许您管理**网络地址转换**（**NAT**）规则。在下面的示例中，我们要求所有命中公共IP地址`123.123.123.123`上的端口`2222`的流量被转发到IP地址为`192.0.10.20`的虚拟机上的端口`22`：
- en: '[PRE2]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'This means that to access SSH on the virtual machine `192.0.10.20` from our
    external network, we would need to run something like the following command:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着要从我们的外部网络访问虚拟机`192.0.10.20`上的SSH，我们需要运行类似以下命令：
- en: '[PRE3]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Assuming we had the correct firewall rules in place, we should be routed through
    the `192.0.10.20` virtual machine.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们已经设置了正确的防火墙规则，我们应该通过`192.0.10.20`虚拟机进行路由。
- en: The vca_vapp module
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vca_vapp模块
- en: 'This module is used to both create and manage vApps. A vApp is one or more
    virtual machines which is combined to offer an application:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块用于创建和管理vApps。vApp是一个或多个虚拟机的组合，用于提供一个应用程序：
- en: '[PRE4]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The previous example is a really basic example of how you would use the `vca_vapp`
    module to ensure that there is a vApp called `Example` present and powered on.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 上一个示例是使用`vca_vapp`模块的一个非常基本的示例，以确保存在名为`Example`的vApp并且处于开启状态。
- en: VMware vSphere
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VMware vSphere
- en: VMware vSphere is a suite of software from VMware which is made up of several
    VMware components. This is where VMware can get a little confusing as VMware vSphere
    is made up of VMware vCentre and VMware ESXi, each of which has their own Ansible
    modules as well, and on the face of it, they appear to accomplish similar tasks.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: VMware vSphere是由VMware组件组成的软件套件。这就是VMware可能会让人有点困惑的地方，因为VMware vSphere由VMware
    vCentre和VMware ESXi组成，它们各自也有自己的Ansible模块，并且在表面上，它们似乎完成了类似的任务。
- en: The vmware_cluster module
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_cluster模块
- en: 'This module allows you to manage your VMware vSphere cluster. A VMware vSphere
    cluster is a collection of hosts, which when clustered together share resources,
    allowing you to add **high availability** (**HA**) and also launch a **Distributed
    Resource Scheduler** (**DRS**) which manages the placement of workloads within
    your cluster:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块允许您管理您的VMware vSphere集群。VMware vSphere集群是一组主机，当它们被集群在一起时，它们共享资源，允许您添加**高可用性**（**HA**），并且还可以启动**分布式资源调度器**（**DRS**），它管理集群中工作负载的放置：
- en: '[PRE5]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The preceding code would loop through a list of hosts, usernames, and passwords
    to create a cluster.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的代码将循环遍历主机、用户名和密码列表以创建一个集群。
- en: The vmware_datacenter module
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_datacenter模块
- en: 'A VMware vSphere data center is the name given to the collection of physical
    resources, hosts, storage, and networking which power your cluster:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: VMware vSphere数据中心是指支持您的集群的物理资源、主机、存储和网络的集合的名称：
- en: '[PRE6]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The previous example adds the hosts listed in `vsphere_hosts` to the `my_datacenter`
    VMware vSphere data center.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 上一个示例将`vsphere_hosts`中列出的主机添加到`my_datacenter` VMware vSphere数据中心。
- en: The vmware_vm_facts module
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_vm_facts模块
- en: 'This module can be used to gather facts on either virtual machines or templates
    which are running in your VMware vSphere cluster:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块可用于收集运行在您的VMware vSphere集群中的虚拟机或模板的信息：
- en: '[PRE7]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The previous example gathers information on just the virtual machines that have
    been created with our cluster and registers the results as the `vm_facts` variable.
    If we wanted to find information on just the templates, we could update `vm_type`
    to template, or we could list all virtual machines and templates by updating `vm_type`
    to all.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 上一个示例仅收集了在我们的集群中创建的虚拟机的信息，并将结果注册为`vm_facts`变量。如果我们想要找到有关模板的信息，我们可以将`vm_type`更新为template，或者我们可以通过将`vm_type`更新为all来列出所有虚拟机和模板。
- en: The vmware_vm_shell module
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_vm_shell模块
- en: 'This module can be used to connect to a virtual machine using VMware and to
    run a shell command. At no point does Ansible need to connect to the virtual machine
    using a network-based service such as SSH, making it useful for configuring VMs
    before they are on the network:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块可用于连接到使用VMware的虚拟机并运行shell命令。在任何时候，Ansible都不需要使用诸如SSH之类的基于网络的服务连接到虚拟机，这对于在虚拟机上线之前配置VM非常有用：
- en: '[PRE8]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The previous example connects to a VM called `example_vm`, which is stored
    in the `my_vms` folder at the root of the `my_datacenter` data center. Once connected
    using the username and password we provide, it runs the following command:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 上一个示例连接到名为`example_vm`的VM，该VM存储在`my_datacenter`数据中心根目录下的`my_vms`文件夹中。一旦使用我们提供的用户名和密码连接后，它将运行以下命令：
- en: '[PRE9]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: In the `/tmp` folder on the VM, the output of running the command is then registered
    as `shell_results` so that we can use it later.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在VM的`/tmp`文件夹中，运行命令的输出被注册为`shell_results`，以便我们以后可以使用它。
- en: The vmware_vm_vm_drs_rule module
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_vm_vm_drs_rule模块
- en: 'With this module, you can configure VMware DRS Affinity rules. These allow
    you to control the placement of virtual machines within your cluster:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以配置VMware DRS亲和性规则。这允许您控制集群中虚拟机的放置：
- en: '[PRE10]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: In the previous example, we are creating a rule that will result in the VMs
    `example_vm` and `another_example_vm` never running on the same physical host.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一个示例中，我们正在创建一个规则，使得VMs `example_vm`和`another_example_vm`永远不会在同一台物理主机上运行。
- en: The vmware_vm_vss_dvs_migrate module
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_vm_vss_dvs_migrate模块
- en: 'This module migrates the named virtual machine from standard vSwitches, which
    are tied to a single host, to a distributed vSwitch that''s available across your
    cluster:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块将指定的虚拟机从标准vSwitch迁移到分布式vSwitch，后者可在整个集群中使用。
- en: '[PRE11]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: As you can see, we are moving the `example_vm` from the standard vSwitch to
    the distributed vSwitch called `example_portgroup`.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，我们正在将`example_vm`从标准vSwitch移动到名为`example_portgroup`的分布式vSwitch。
- en: The vsphere_copy module
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vsphere_copy模块
- en: 'This module has a single purpose—to copy a local file to a remote data store:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块有一个单一的目的——将本地文件复制到远程数据存储：
- en: '[PRE13]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: As you can see, we are copying the file from `/path/to/local/file` to `path/to/remove/file`
    in the `my_datastore` data store which is hosted in the `my_datacenter` data center.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，我们正在将文件从`/path/to/local/file`复制到`my_datacenter`数据中心中托管的`my_datastore`数据存储中的`path/to/remove/file`。
- en: The vsphere_guest module
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vsphere_guest模块
- en: This module has been deprecated and will be removed in Ansible 2.9; it is recommended
    you use the `vmware_guest` module instead.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块已被弃用，并将在Ansible 2.9中删除；建议您改用`vmware_guest`模块。
- en: VMware vCentre
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VMware vCentre
- en: VMware vCentre is an important component of the VMware vSphere suite; it enables
    the clustering of features such as vMotion, the VMware Distributed Resource Scheduler,
    and VMware High Availability.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: VMware vCentre是VMware vSphere套件的重要组件；它使诸如vMotion、VMware分布式资源调度器和VMware高可用性等功能进行集群化。
- en: The vcenter_folder module
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vcenter_folder模块
- en: 'This module enables vCenter folder management. For example, the following sample
    creates a folder for your virtual machines:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块使vCenter文件夹管理成为可能。例如，以下示例为您的虚拟机创建一个文件夹：
- en: '[PRE14]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Here is an example of creating a folder for your hosts:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是为您的主机创建文件夹的示例：
- en: '[PRE15]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: The vcenter_license module
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vcenter_license模块
- en: 'This module lets you add and remove VMware vCenter licenses:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块允许您添加和删除VMware vCenter许可证：
- en: '[PRE16]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: The vmware_guest module
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_guest模块
- en: 'This module allows you to launch and manage virtual machines within your VMware
    cluster; the following example shows how you would launch a VM using a template:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块允许您在VMware集群中启动和管理虚拟机；以下示例显示了如何使用模板启动VM：
- en: '[PRE17]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: As you can see, we have quite a lot of control over the VM and how it is configured.
    There are separate sections for the hardware, network, and storage configuration;
    we will look at this module in a little more detail at the end of this chapter.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您所看到的，我们对VM及其配置有相当多的控制权。硬件、网络和存储配置有单独的部分；我们将在本章末稍微详细地看一下这个模块。
- en: The vmware_guest_facts module
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_guest_facts模块
- en: 'This module gathers information on already created VMs:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块收集有关已创建的VM的信息：
- en: '[PRE18]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: The previous example gathers lots of information on the machine we defined in
    the previous section and registers the information as a variable so that we can
    use it elsewhere in our playbook run.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的示例收集了我们在上一节中定义的机器的大量信息，并将信息注册为变量，以便我们可以在playbook运行的其他地方使用它。
- en: The vmware_guest_file_operation module
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_guest_file_operation模块
- en: 'This module was introduced in Ansible 2.5; it allows you to add and fetch files
    from a VM without the need for the VM to be on a network. It also allows you to
    create folders within the VM. The following example creates a directory within
    the VM:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块是在Ansible 2.5中引入的；它允许您在VM上添加和获取文件，而无需VM连接到网络。它还允许您在VM内创建文件夹。以下示例在VM内创建一个目录：
- en: '[PRE19]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The following example copies a file called `config.zip` from our Ansible host
    to the directory created previously:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例将名为`config.zip`的文件从我们的Ansible主机复制到先前创建的目录中：
- en: '[PRE20]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: The vmware_guest_find module
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_guest_find模块
- en: 'We know the name of the folder in which the VM has been running. If we didn''t,
    or if it changed for any reason, we could use the `vmware_guest_find` module to
    dynamically discover the location:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 我们知道VM运行的文件夹的名称。如果我们不知道，或者由于任何原因发生了更改，我们可以使用`vmware_guest_find`模块动态发现位置：
- en: '[PRE21]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The name of the folder will be registered as `vm_folder`.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 文件夹的名称将注册为`vm_folder`。
- en: The vmware_guest_powerstate module
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_guest_powerstate模块
- en: 'This module is self-explanatory; it is used to manage the power stage of your
    VM. The following example power cycles a VM:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 这个模块很容易理解；它用于管理VM的电源状态。以下示例重新启动了一个VM：
- en: '[PRE22]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'You can also schedule changes to the power state. The following example powers
    down the VM at 9 a.m. on the 1st April 2019:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以安排对电源状态的更改。以下示例在2019年4月1日上午9点关闭VM：
- en: '[PRE23]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Not that I would ever do something like that!
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 并不是我会做这样的事情！
- en: The vmware_guest_snapshot module
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_guest_snapshot模块
- en: 'This module allows you to manage your VM snapshots; for example, the following
    creates a snapshot:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块允许您管理VM快照；例如，以下创建了一个快照：
- en: '[PRE24]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'As you can see from the previous example, this snapshot is being taken because
    we are about to patch the VM. If the patching goes as expected, then we can run
    the following task:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 从前面的示例中可以看出，这个快照是因为我们即将对VM进行打补丁。如果打补丁顺利进行，那么我们可以运行以下任务：
- en: '[PRE25]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'If nothing goes as planned and the patching breaks our VM, then not to worry,
    we have a snapshot we can revert to:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切不如预期那样进行，打补丁破坏了我们的VM，那么不用担心，我们有一个可以恢复的快照：
- en: '[PRE26]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Fingers crossed that you never have to revert to a snapshot (unless it is planned).
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 祈祷您永远不必恢复快照（除非计划中）。
- en: The vmware_guest_tools_wait module
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_guest_tools_wait模块
- en: 'The final module of this section is another self-explanatory one; it simply
    waits for VMware tools to become available and then gathers facts on the machine:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 本节的最后一个模块是另一个很容易理解的模块；它只是等待VMware tools可用，然后收集有关该机器的信息：
- en: '[PRE27]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: VMware tools is an application that runs inside the VM. Once it starts, it allows
    VMware to interact with the VM, allowing modules such as `vmware_guest_file_operation`
    and `vmware_vm_shell` to function.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: VMware tools是在VM内部运行的应用程序。一旦启动，它允许VMware与VM进行交互，从而使诸如`vmware_guest_file_operation`和`vmware_vm_shell`等模块能够正常运行。
- en: VMware ESXi
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VMware ESXi
- en: At the heart of most VMware installations is a number of VMware ESXi hosts.
    VMware ESXi is the type 1 hypervisor that enables VMs to run. Ansible provides
    several modules that allow you to configure and interact with your VMware ESXi
    hosts.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数VMware安装的核心是一些VMware ESXi主机。VMware ESXi是一种类型1的hypervisor，可以使VM运行。Ansible提供了几个模块，允许您配置和与您的VMware
    ESXi主机进行交互。
- en: The vmware_dns_config module
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_dns_config模块
- en: 'This module lets you manage the DNS aspects of your ESXi host; it lets you
    set the hostname, domain, and the DNS resolvers:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块允许您管理ESXi主机的DNS方面；它允许您设置主机名、域和DNS解析器：
- en: '[PRE28]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: In the previous example, we are setting the FQDN of the host to be `esxi-host-01.my-domain.com`
    and also configuring the host to use Google public DNS resolvers.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，我们将主机的FQDN设置为`esxi-host-01.my-domain.com`，并配置主机使用Google公共DNS解析器。
- en: The vmware_host_dns_facts module
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_dns_facts模块
- en: 'A simple module that gathers facts on the DNS configuration of your VMware
    ESXi hosts follows:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 一个简单的模块，用于收集您的VMware ESXi主机的DNS配置信息：
- en: '[PRE29]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: The vmware_host module
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host模块
- en: 'You can use this module to attach your ESXi host to a vCenter:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用此模块将您的ESXi主机附加到vCenter：
- en: '[PRE30]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'You can also use the module to reattach a host to your vCenter cluster:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用该模块重新连接主机到您的vCenter集群：
- en: '[PRE31]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'You can also remove a host from your vCenter cluster:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以从vCenter集群中删除主机：
- en: '[PRE32]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: The vmware_host_facts module
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_facts模块
- en: 'As you may have guessed, this module gathers facts about the VMware ESXi hosts
    within your vSphere or vCenter cluster:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您可能已经猜到的那样，此模块收集有关您的vSphere或vCenter集群中的VMware ESXi主机的信息：
- en: '[PRE33]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: The vmware_host_acceptance module
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_acceptance模块
- en: 'With this module, you can manage the acceptance level of your VMware ESXi host.
    There are four acceptance levels supported by VMware, and these are:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以管理VMware ESXi主机的接受级别。VMware支持四个接受级别，它们是：
- en: VMwareCertified
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VMwareCertified
- en: VMwareAccepted
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VMwareAccepted
- en: PartnerSupported
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PartnerSupported
- en: CommunitySupported
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CommunitySupported
- en: 'These levels control the VIBs which can be installed on the ESXi host; a VIB
    is an ESXi software package. This typically dictates the level of support you
    will receive from either VMware or a VMware partner. The following task will set
    the acceptance level to CommunitySupported for all of the ESXi hosts in the named
    cluster:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 这些级别控制着可以安装在ESXi主机上的VIB；VIB是ESXi软件包。这通常决定了您将从VMware或VMware合作伙伴那里获得的支持水平。以下任务将为指定集群中的所有ESXi主机设置接受级别为CommunitySupported：
- en: '[PRE34]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The vmware_host_config_manager module
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_config_manager模块
- en: 'Using this module, you can set configuration options on your individual VMware
    ESXi hosts, for example:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以在各个VMware ESXi主机上设置配置选项，例如：
- en: '[PRE35]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Ansible maps the advanced configurations options from your VMware host, so for
    more information on the available options, please consult your documentation.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: Ansible将从您的VMware主机映射高级配置选项，因此有关可用选项的更多信息，请参阅您的文档。
- en: The vmware_host_datastore module
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_datastore模块
- en: 'This module gives you the power to mount and dismount datastores on your VMware
    ESXi hosts; in the following example, we are mounting three datastores on all
    of the VMware ESXi hosts within our inventory:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块使您能够在VMware ESXi主机上挂载和卸载数据存储；在以下示例中，我们正在在清单中的所有VMware ESXi主机上挂载三个数据存储：
- en: '[PRE36]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: The vmware_host_firewall_manager module
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_firewall_manager模块
- en: 'This module lets you configure the firewall rules on your VMware ESXi hosts:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块允许您配置VMware ESXi主机上的防火墙规则：
- en: '[PRE37]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The previous example enables `vvold` and disables `CIMHttpServer` on each of
    the VMware ESXi hosts in the host inventory.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 上一个示例在主机清单中的每个VMware ESXi主机上启用了`vvold`并禁用了`CIMHttpServer`。
- en: The vmware_host_firewall_facts module
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_firewall_facts模块
- en: 'As you will have already guessed, this module, like the other facts modules,
    is used to gather facts on the firewall configuration of all of the hosts within
    our cluster:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您可能已经猜到的那样，此模块与其他事实模块一样，用于收集我们集群中所有主机的防火墙配置的信息：
- en: '[PRE38]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'It can also gather for just a single host:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 它也可以仅收集单个主机的信息：
- en: '[PRE39]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: The vmware_host_lockdown module
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_lockdown模块
- en: 'This module comes with a warning which reads: This module is destructive as
    administrator permission are managed using APIs used, please read options carefully
    and proceed..'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块带有一个警告，内容为：此模块具有破坏性，因为管理员权限是使用API管理的，请仔细阅读选项并继续。
- en: 'You can lock down a host with the following code:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下代码锁定主机：
- en: '[PRE40]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'You can take a host out of lockdown using:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下方法将主机解除锁定：
- en: '[PRE41]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'As mentioned previously, this module may have some unexpected side effects,
    so you may want to do this on a per-host basis, rather than using the following
    option, which will put all hosts in the named cluster into lockdown:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 如先前提到的，此模块可能会产生一些意想不到的副作用，因此您可能希望逐个主机执行此操作，而不是使用以下选项，该选项将使指定集群中的所有主机进入锁定状态：
- en: '[PRE42]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: The vmware_host_ntp module
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_ntp模块
- en: 'With this module, you can manage the NTP settings for each of the VMware ESXi
    hosts. The following example configures all of the hosts to use the same set of
    NTP servers:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以管理每个VMware ESXi主机的NTP设置。以下示例配置所有主机使用相同的NTP服务器：
- en: '[PRE43]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: The vmware_host_package_facts module
  id: totrans-170
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_package_facts模块
- en: 'This module can be used to gather facts on all of the VMware ESXi hosts within
    your cluster:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块可用于收集有关您集群中所有VMware ESXi主机的信息：
- en: '[PRE44]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Like the rest of the facts modules, it can also gather for just a single host:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 与其他事实模块一样，它也可以仅收集单个主机的信息：
- en: '[PRE45]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: The vmware_host_service_manager module
  id: totrans-175
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_service_manager模块
- en: 'This module lets you manage ESXi servers on either all of your cluster members
    or individual hosts:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块可让您管理集群成员或单个主机上的ESXi服务器：
- en: '[PRE46]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: In this example, we are starting the NTP service (`service_name`) on all hosts
    within the cluster; as we have the `service_policy` defined as `automatic`, the
    service will only start if the services corresponding to the firewall rule have
    been configured. If we wanted the service to start regardless of the firewall
    rule, then we could set `service_policy` to `on` or if wanted to the service to
    be stopped, then `service_policy` should be set to `off`.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，我们正在启动集群中所有主机的NTP服务（`service_name`）；由于我们将`service_policy`定义为`automatic`，因此只有在配置了与防火墙规则相对应的服务时，服务才会启动。如果我们希望服务无论防火墙规则如何都启动，那么我们可以将`service_policy`设置为`on`，或者如果希望停止服务，则应将`service_policy`设置为`off`。
- en: The vmware_host_service_facts module
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_service_facts模块
- en: 'With this module, you can find out facts on the services configured on each
    of the VMware ESXi hosts within the cluster:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以查找集群中每个VMware ESXi主机上配置的服务的信息：
- en: '[PRE47]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: The vmware_datastore_facts module
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_datastore_facts模块
- en: 'This is one of the old-style facts modules which can be used to gather information
    on the data stores configured in the data center:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个旧式事实模块，可用于收集数据中心中配置的数据存储的信息：
- en: '[PRE48]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: You may notice that there is a little bit of a difference in the syntax between
    this and the previous facts modules.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能会注意到这个和之前的事实模块之间的语法有一点不同。
- en: The vmware_host_vmnic_facts module
  id: totrans-186
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_host_vmnic_facts模块
- en: 'From an old-style fact module back to a new one, this module can be used to
    gather information on the physical network interfaces on your VMware ESXi hosts:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 从旧式事实模块返回到新模块，此模块可用于收集有关VMware ESXi主机上物理网络接口的信息：
- en: '[PRE49]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'For a single ESXi host, we could use the following task:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 对于单个ESXi主机，我们可以使用以下任务：
- en: '[PRE50]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: The vmware_local_role_manager module
  id: totrans-191
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_local_role_manager模块
- en: 'Using this module, you can configure roles on your cluster; these roles can
    be used to assign privileges. In the following example, we are assigning a few
    privileges to the `vmware_qa` role:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以在集群上配置角色；这些角色可用于分配特权。在以下示例中，我们正在为`vmware_qa`角色分配一些特权：
- en: '[PRE51]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: The vmware_local_user_manager module
  id: totrans-194
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_local_user_manager模块
- en: 'With this module, you can manage local users by adding users and setting their
    passwords:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以通过添加用户并设置其密码来管理本地用户：
- en: '[PRE52]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: The vmware_cfg_backup module
  id: totrans-197
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_cfg_backup模块
- en: 'Using this module, you can create a backup of a VMware ESXi host configuration:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以创建VMware ESXi主机配置的备份：
- en: '[PRE53]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: Please note that this module will automatically put the host into maintenance
    and then save the configuration too. In the preceding example, from `/tmp`, you
    can use the information registered to grab a copy of the backup using the `fetch`
    module.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，此模块将自动将主机置于维护状态，然后保存配置。在前面的示例中，您可以使用`fetch`模块使用`/tmp`中注册的信息来获取备份的副本。
- en: 'You can also use this module to restore a configuration:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用此模块恢复配置：
- en: '[PRE54]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: '[PRE55]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Finally, you can also reset a host configuration back to its default settings
    by running the following code:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，您还可以通过运行以下代码将主机配置重置为默认设置：
- en: '[PRE56]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: The vmware_vmkernel module
  id: totrans-206
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_vmkernel模块
- en: 'This module allows you to add VMkernel interfaces, which are also known as
    Virtual NICs on a host:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块允许您在主机上添加VMkernel接口，也称为虚拟NIC：
- en: '[PRE57]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'In the previous example, we added a management interface; there are also the
    following options:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，我们添加了一个管理接口；还有以下选项：
- en: '`enable_ft`: Enables an interface for fault tolerance traffic'
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`enable_ft`：启用容错流量的接口'
- en: '`enable_mgmt`: Enables an interface for management traffic'
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`enable_mgmt`：启用管理流量的接口'
- en: '`enable_vmotion`: Enables an interface for VMotion traffic'
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`enable_vmotion`：启用VMotion流量的接口'
- en: '`enable_vsan`: Enables an interface for VSAN traffic'
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`enable_vsan`：启用VSAN流量的接口'
- en: The vmware_vmkernel_facts module
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_vmkernel_facts模块
- en: 'Yet another facts module, this is a a new-style module; you have probably already
    guessed what the task will look like:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个事实模块，这是一个新式模块；您可能已经猜到任务的样子：
- en: '[PRE58]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: The vmware_target_canonical_facts module
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_target_canonical_facts模块
- en: 'Using this module, you can find out the canonical name of an SCSI target; all
    you need to know is the ID of the target device:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以找出SCSI目标的规范名称；您只需要知道目标设备的ID：
- en: '[PRE59]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: The vmware_vmotion module
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_vmotion模块
- en: 'You can use this module to perform a vMotion of a virtual machine from one
    VMware ESXi host to another:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用此模块执行虚拟机从一个VMware ESXi主机迁移到另一个主机的vMotion：
- en: '[PRE60]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: The vmware_vsan_cluster module
  id: totrans-223
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_vsan_cluster模块
- en: You can use this module to register a VSAN cluster; this module works slightly
    differently to the other modules in this chapter in that you first need to generate
    a cluster UUID on a single host before deploying the VSAN on the remaining hosts
    using the UUIDs generated.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用此模块注册VSAN集群；此模块的工作方式与本章中的其他模块略有不同，您首先需要在单个主机上生成集群UUID，然后再使用生成的UUID在其余主机上部署VSAN。
- en: 'The following tasks assume you have a host group called `esxi_hosts`, which
    contains more than one host. The first task assigns the VSAN to the first host
    in the group, then registers the results:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 以下任务假定您有一个名为`esxi_hosts`的主机组，其中包含多个主机。第一个任务将VSAN分配给组中的第一个主机，然后注册结果：
- en: '[PRE61]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'The results, registered as `vsan_cluster`, contain the VSAN cluster UUID which
    we will need for the rest of the hosts in the group. The following code configures
    the cluster on the remaining hosts, skipping the original host:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 作为`vsan_cluster`注册的结果包含我们将需要在组中其余主机上使用的VSAN集群UUID。以下代码配置了其余主机上的集群，跳过原始主机：
- en: '[PRE62]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: The vmware_vswitch module
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_vswitch模块
- en: 'Using this module, you can add or remove a **VMware Standard Switch** (**vSwitch**)
    to an ESXi host:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以向ESXi主机添加或删除**VMware标准交换机**（**vSwitch**）：
- en: '[PRE63]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: In this example, we have added a vSwitch that's attached to multiple vmnics.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，我们添加了一个连接到多个vmnic的vSwitch。
- en: The vmware_drs_rule_facts module
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_drs_rule_facts模块
- en: 'You can use this module to gather facts on the DRS configured in your entire
    cluster or single data center:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用此模块收集整个集群或单个数据中心中配置的DRS的事实：
- en: '[PRE64]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: The vmware_dvswitch module
  id: totrans-236
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_dvswitch模块
- en: 'This module allows you to create and remove distributed vSwitches:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块允许您创建和删除分布式vSwitches：
- en: '[PRE65]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: The vmware_dvs_host module
  id: totrans-239
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_dvs_host模块
- en: 'Using this module, you can add or remove a host from the distributed virtual
    switch:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以向分布式虚拟交换机添加或删除主机：
- en: '[PRE66]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: The vmware_dvs_portgroup module
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_dvs_portgroup模块
- en: 'With this module, you can manage your DVS port groups:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以管理您的DVS端口组：
- en: '[PRE67]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: The vmware_maintenancemode module
  id: totrans-245
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_maintenancemode模块
- en: 'Using this module, you can place a host into maintenance mode. The following
    example shows you how to put a host into maintenance while maintaining object
    availability on the VSAN:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此模块，您可以将主机置于维护模式。以下示例向您展示了如何在VSAN上保持对象可用性的同时将主机置于维护模式：
- en: '[PRE68]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: The vmware_portgroup module
  id: totrans-248
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_portgroup模块
- en: 'This module lets you create a VMware port group on the hosts in a given cluster:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 此模块允许您在给定集群中的主机上创建VMware端口组：
- en: '[PRE69]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: The vmware_resource_pool module
  id: totrans-251
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vmware_resource_pool模块
- en: 'With this, the final module we are going to look at, you can create a resource
    pool. An example of how to do this follows:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这个，我们要看的最后一个模块，您可以创建一个资源池。以下是如何执行此操作的示例：
- en: '[PRE70]'
  id: totrans-253
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: An example playbook
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 一个示例playbook
- en: 'Before we complete this chapter, I am going to share an example playbook I
    wrote for deploying a small number of virtual machines in a VMware cluster. The
    idea with the project was to launch seven virtual machines into a customer''s
    network which are as follows:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在完成本章之前，我将分享一个我为在VMware集群中部署少量虚拟机编写的示例playbook。该项目的想法是将七台虚拟机启动到客户的网络中，如下所示：
- en: One Linux jump host
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个Linux跳板主机
- en: One NTP server
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个NTP服务器
- en: One load balancer
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个负载均衡器
- en: Two web servers
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 两个Web服务器
- en: Two database servers
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 两个数据库服务器
- en: The VMs all had to be built from an existing template; unfortunately, this template
    was built with a hardcoded gateway IP address of `192.168.1.254` in the `/etc/sysconfig/network`
    file. This meant that for these machines to correctly appear on the network, I
    had to make changes to each of the virtual machines once they had been launched.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 所有VM都必须从现有模板构建；不幸的是，这个模板是使用`/etc/sysconfig/network`文件中硬编码的网关IP地址`192.168.1.254`构建的。这意味着为了让这些机器正确出现在网络上，我必须在每台虚拟机启动后进行更改。
- en: 'I started off by setting up a file called `vmware.yml` in my `group_vars` folder;
    this contained the information needed to connect to my VMware installation and
    also the default credentials for the VMs:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 我首先在我的`group_vars`文件夹中设置了一个名为`vmware.yml`的文件；其中包含了连接到我的VMware安装所需的信息，以及VM的默认凭据：
- en: '[PRE71]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'I will be using the variables defined in both of the roles I will be running.
    Next up, there is the `group_vars/vms.yml` file; this contains all of the information
    needed to launch the virtual machines in my VMware environment:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 我将使用两个角色中定义的变量。接下来是`group_vars/vms.yml`文件；其中包含了在我的VMware环境中启动虚拟机所需的所有信息：
- en: '[PRE72]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: As you can see, I am defining the specs, networks, and storage for all seven
    VMs; where possible, I am thin provisioning storage and also making sure that
    where there is more than one virtual machine in a role I am using different storage
    pools.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，我正在为所有七台VM定义规格、网络和存储；在可能的情况下，我正在进行存储的薄配置，并确保在一个角色中有多个虚拟机时，我正在使用不同的存储池。
- en: 'Now that I have all of the details needed for my virtual machines, I can create
    the roles. First of all, there is `roles/vmware/tasks/main.yml`:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我已经拥有了我虚拟机所需的所有细节，我可以创建角色了。首先是`roles/vmware/tasks/main.yml`：
- en: '[PRE73]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: As you can see, this task loops through the items in the `vm` variable; once
    the virtual machine has been launched, it will wait for the IP address I have
    assigned to be available within VMware. This makes sure that the virtual machine
    is correctly launched before proceeding with either launching the next virtual
    machine or moving on to the next role.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，这个任务循环遍历`vm`变量中的项目；一旦虚拟机启动，它将等待我分配的IP地址在VMware中可用。这确保了在启动下一个虚拟机或继续下一个角色之前，虚拟机已经正确启动。
- en: 'The next role resolves the problem of `192.168.1.254` being hardcoded as the
    gateway in the virtual machine template; it can be found in `roles/fix/tasks/main.yml`.
    There are two tasks in the role; the first one updates the gateway to the correct
    one for the network the virtual machine has been launched in:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个角色解决了在虚拟机模板中硬编码为`192.168.1.254`的网关的问题；它可以在`roles/fix/tasks/main.yml`中找到。该角色中有两个任务；第一个任务将网关更新为虚拟机所在网络的正确网关：
- en: '[PRE74]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'As you can see, this loops through the list of virtual machines defined as
    `vm` and executes the `sed` command we defined in the `group_vars/vmware.yml`
    file. Once this task has run, we need to run one more task. This one restarts
    networking on all of the virtual machines so that the changes to the gateway are
    picked up:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，这个任务循环遍历定义为`vm`的虚拟机列表，并执行我们在`group_vars/vmware.yml`文件中定义的`sed`命令。一旦这个任务运行完毕，我们需要再运行一个任务。这个任务重新启动所有虚拟机上的网络，以便网关的更改被接受：
- en: '[PRE75]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: When I ran the playbook, it took about 30 minutes to run, but at the end of
    it I had the seven virtual machines launched and available to work, so I was then
    able to run the set of playbooks which bootstrapped the environment ready so that
    I could hand them over to the customer for them to deploy their application.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 当我运行playbook时，大约需要30分钟才能运行完，但最终我启动了七台虚拟机，并且可以使用，所以我随后能够运行一系列的playbooks，对环境进行引导，以便我可以将它们交给客户，让他们部署他们的应用程序。
- en: Summary
  id: totrans-275
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: As you have seen from the very long list of modules, you can do pretty much
    most of the common tasks you would be doing as a VMware administrator using Ansible.
    Add to this the modules we looked at in [Chapter 7](ea3a1a37-b99d-4837-b458-d8a24c6cc39c.xhtml),
    *The Core Network Modules*, for managing network equipment, and also modules such
    as the ones that support NetApp storage devices, and you can build some quite
    complex playbooks which span the physical devices, VMware elements, and even the
    virtual machines running within your virtualized infrastructure.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你从非常长的模块列表中所看到的，你可以使用Ansible来完成大部分作为VMware管理员的常见任务。再加上我们在[第7章](ea3a1a37-b99d-4837-b458-d8a24c6cc39c.xhtml)中所看到的*核心网络模块*，用于管理网络设备，以及支持NetApp存储设备的模块，你可以构建一些跨物理设备、VMware元素甚至在虚拟化基础设施中运行的虚拟机的复杂playbooks。
- en: In the next chapter, we will see how to build our Windows servers locally using
    Vagrant and then take our playbooks to the public cloud.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将看到如何使用Vagrant在本地构建我们的Windows服务器，然后将我们的playbooks移到公共云。
- en: Questions
  id: totrans-278
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Which Python module do you need to install on your Ansible controller to be
    able to interact with vSphere?
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你需要在你的Ansible控制器上安装哪个Python模块才能与vSphere进行交互？
- en: 'True or false: `vmware_dns_config` only allows you to set the DNS resolvers
    on your ESXi hosts.'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 真或假：`vmware_dns_config`只允许你在你的ESXi主机上设置DNS解析器。
- en: Name two of the modules we have covered that can be used to launch virtual machines;
    there are three, but one is deprecated.
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列举我们已经涵盖的两个可以用来启动虚拟机的模块的名称；有三个，但其中一个已被弃用。
- en: Which of the modules we have looked at would you use to ensure that a virtual
    machine is fully available before progressing to a task that interacts with the
    VM via VMware?
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们已经查看的模块中，你会使用哪一个来确保虚拟机在进行与VMware交互的任务之前完全可用？
- en: 'True or false: It is possible to schedule the change of a power state using
    Ansible.'
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 真或假：使用Ansible可以安排更改电源状态。
- en: Further reading
  id: totrans-284
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'For a good overview of VMware vSphere, I would recommend the following video:
    [https://www.youtube.com/watch?v=3OvrKZYnzjM](https://www.youtube.com/watch?v=3OvrKZYnzjM).'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 关于VMware vSphere的一个很好的概述，我推荐观看以下视频：[https://www.youtube.com/watch?v=3OvrKZYnzjM](https://www.youtube.com/watch?v=3OvrKZYnzjM)。
