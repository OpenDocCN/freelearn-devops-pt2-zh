- en: Building Production-Ready Kubernetes Clusters
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: 构建生产就绪的Kubernetes集群
- en: This chapter proposes the most common deployment methods that are used on popular
    cloud services as well as on-premises, although you will certainly find a number
    of other tutorials on the internet explaining other approaches. This chapter explains
    the differences between managed/hosted cloud services versus self-managed cloud
    or on-premises Kubernetes deployments and the advantages of one vendor over another.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章提出了最常用的部署方法，这些方法在流行的云服务以及本地都有使用，尽管您肯定会在互联网上找到其他教程，解释其他方法。本章解释了托管/托管云服务与自我管理云或本地Kubernetes部署之间的区别，以及一个供应商相对于另一个的优势。
- en: 'In this chapter, we will be covering the following recipes:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下示例：
- en: Configuring a Kubernetes cluster on Amazon Web Services
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在亚马逊网络服务上配置Kubernetes集群
- en: Configuring a Kubernetes cluster on Google Cloud Platform
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在谷歌云平台上配置Kubernetes集群
- en: Configuring a Kubernetes cluster on Microsoft Azure
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Microsoft Azure上配置Kubernetes集群
- en: Configuring a Kubernetes cluster on Alibaba Cloud
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在阿里云上配置Kubernetes集群
- en: Configuring and managing Kubernetes clusters with Rancher
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Rancher配置和管理Kubernetes集群
- en: Configuring Red Hat OpenShift
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置Red Hat OpenShift
- en: Configuring a Kubernetes cluster using Ansible
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Ansible配置Kubernetes集群
- en: Troubleshooting installation issues
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故障排除安装问题
- en: Technical requirements
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: It is recommended that you have a fundamental knowledge of Linux containers
    and Kubernetes in general. For preparing your Kubernetes clusters, using a Linux
    host is recommended. If your workstation is Windows-based, then we recommend that
    you use **Windows Subsystem for Linux** (**WSL**). WSL gives you a Linux command
    line on Windows and lets you run ELF64 Linux binaries on Windows.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 建议您对Linux容器和Kubernetes有基本的了解。为了准备您的Kubernetes集群，建议使用Linux主机。如果您的工作站基于Windows，则建议您使用**Windows子系统用于Linux**（**WSL**）。WSL在Windows上提供了一个Linux命令行，并允许您在Windows上运行ELF64
    Linux二进制文件。
- en: It's always good practice to develop using the same environment (which means
    the same distribution and the same version) as the one that will be used in production.
    This will avoid unexpected surprises such as **It Worked on My Machine** (**IWOMM**).
    If your workstation is using a different OS, another good approach is to set up
    a virtual machine on your workstation. VirtualBox ([https://www.virtualbox.org/](https://www.virtualbox.org/))
    is a free and open source hypervisor that runs on Windows, Linux, and macOS.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 始终使用相同的环境进行开发是一个良好的实践（这意味着相同的发行版和相同的版本），就像将在生产中使用的一样。这将避免意外的惊喜，比如**它在我的机器上运行**（**IWOMM**）。如果您的工作站使用不同的操作系统，另一个很好的方法是在您的工作站上设置一个虚拟机。VirtualBox（[https://www.virtualbox.org/](https://www.virtualbox.org/)）是一个在Windows、Linux和macOS上运行的免费开源的虚拟化程序。
- en: 'In this chapter, we''ll assume that you are using an Ubuntu host (18.04, code
    name Bionic Beaver at the time of writing). There are no specific hardware requirements
    since all the recipes in this chapter will be deployed and run on cloud instances.
    Here is the list of software packages that will be required on your localhost
    to complete the recipes:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们假设您正在使用Ubuntu主机（18.04，在撰写时的代号为Bionic Beaver）。由于本章中的所有示例都将部署和运行在云实例上，因此没有特定的硬件要求。以下是在本地主机上完成示例所需的软件包列表：
- en: cURL
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: cURL
- en: Python
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python
- en: Vim or Nano (or your favorite text editor)
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Vim或Nano（或您喜欢的文本编辑器）
- en: Configuring a Kubernetes cluster on Amazon Web Services
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在亚马逊网络服务上配置Kubernetes集群
- en: The recipes in this section will take you through how to get a fully functional
    Kubernetes cluster with a fully customizable master and worker nodes that you
    can use for the recipes in the following chapters or in production.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中的操作将带您了解如何获得一个功能齐全的Kubernetes集群，具有完全可定制的主节点和工作节点，您可以在以下章节或生产中使用。
- en: In this section, we will cover both Amazon EC2 and Amazon EKS recipes so that
    we can run Kubernetes on **Amazon Web Services** (**AWS**).
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将涵盖Amazon EC2和Amazon EKS的操作步骤，以便我们可以在**Amazon Web Services**（**AWS**）上运行Kubernetes。
- en: Getting ready
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: All the operations mentioned here require an AWS account and an AWS user with
    a policy that has permission to use the related services. If you don't have one,
    go to [https://aws.amazon.com/account/](https://aws.amazon.com/account/) and create
    one.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 这里提到的所有操作都需要一个AWS账户和一个具有使用相关服务权限的AWS用户。如果您没有，请访问[https://aws.amazon.com/account/](https://aws.amazon.com/account/)并创建一个。
- en: AWS provides two main options when it comes to running Kubernetes on it. You
    can consider using the **Amazon Elastic Compute Cloud** (**Amazon EC2**) if you'd
    like to manage your deployment completely and have specific powerful instance
    requirements. Otherwise, it's highly recommended to consider using managed services
    such as **Amazon Elastic Container Service for Kubernetes** (**Amazon EKS**).
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 当在AWS上运行Kubernetes时，AWS提供了两个主要选项。如果您想完全管理部署并具有特定的强大实例要求，可以考虑使用**Amazon Elastic
    Compute Cloud**（**Amazon EC2**）。否则，强烈建议考虑使用**Amazon Elastic Container Service
    for Kubernetes**（**Amazon EKS**）等托管服务。
- en: How to do it…
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'Depending on whether you want to use AWS EC2 service or EKS, you can follow
    the following recipes to get your cluster up and running using either kops or
    eksctl tools:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 根据您想要使用AWS EC2服务还是EKS，您可以按照以下步骤使用kops或eksctl工具来启动和运行您的集群：
- en: Installing the command-line tools to configure AWS services
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装命令行工具以配置AWS服务
- en: Installing kops to provision a Kubernetes cluster
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装kops以配置Kubernetes集群
- en: Provisioning a Kubernetes cluster on Amazon EC2
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Amazon EC2上配置Kubernetes集群 provision a Kubernetes cluster on Amazon EC2.
- en: Provisioning a managed Kubernetes cluster on Amazon EKS
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Amazon EKS上配置托管的Kubernetes集群
- en: Installing the command-line tools to configure AWS services
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装命令行工具以配置AWS服务
- en: In this recipe, we will get the AWS **Command-Line Interface** (**CLI**) `awscli` and
    the Amazon EKS CLI `eksctl` to access and configure AWS services.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个操作中，我们将获取AWS **命令行界面**（**CLI**）`awscli`和Amazon EKS CLI `eksctl`以访问和配置AWS服务。
- en: 'Let''s perform the following steps:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下步骤：
- en: 'Install `awscli` on your workstation:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的工作站上安装`awscli`：
- en: '[PRE0]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Configure the AWS CLI so that it uses your access key ID and secret access
    key:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置AWS CLI以使用您的访问密钥ID和秘密访问密钥：
- en: '[PRE1]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Download and install the Amazon EKS command-line interface, `eksctl`:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载并安装Amazon EKS命令行界面`eksctl`：
- en: '[PRE2]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Verify its version and make sure `eksctl` is installed:'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证其版本并确保`eksctl`已安装：
- en: '[PRE3]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: To be able to perform the following recipes, the `eksctl` version should be
    `0.13.0` or later.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 为了能够执行以下操作，`eksctl`版本应为`0.13.0`或更高。
- en: Installing kops to provision a Kubernetes cluster
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装kops以配置Kubernetes集群
- en: In this recipe, we will get the Kubernetes Operations tool, `kops`, and Kubernetes
    command-line tool, `kubectl`, installed in order to provision and manage Kubernetes
    clusters.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个操作中，我们将获取Kubernetes操作工具`kops`和Kubernetes命令行工具`kubectl`，以便配置和管理Kubernetes集群。
- en: 'Let''s perform the following steps:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下步骤：
- en: 'Download and install the Kubernetes Operations tool, `kops`:'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载并安装Kubernetes操作工具`kops`：
- en: '[PRE4]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Run the following command to make sure `kops` is installed and confirm that
    the version is `1.15.0` or later:'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令以确保`kops`已安装并确认版本为`1.15.0`或更高：
- en: '[PRE5]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Download and install the Kubernetes command-line tool, `kubectl`:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载并安装Kubernetes命令行工具`kubectl`：
- en: '[PRE6]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Verify its version and make sure `kubectl` is installed:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证其版本并确保`kubectl`已安装：
- en: '[PRE7]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: To be able to perform the following recipes, the `kubectl` version should be
    `v1.15` or later.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 为了能够执行以下操作，`kubectl`版本应该是`v1.15`或更高。
- en: Provisioning a Kubernetes cluster on Amazon EC2
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在Amazon EC2上创建一个Kubernetes集群
- en: This recipe will take you through how to get a fully functional Kubernetes cluster
    with fully customizable master and worker nodes that you can use for the recipes
    in the following chapters or in production.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 这个步骤将带您完成如何获得一个完全可定制的主节点和工作节点的完全功能的Kubernetes集群，您可以在后续章节或生产中使用。
- en: 'Let''s perform the following steps:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下步骤：
- en: Create a domain for your cluster.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为您的集群创建一个域。
- en: It is a cloud management best practice to have subdomains and to divide your
    clusters with logical and valid DNS names for `kops` to successfully discovery
    them.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 按照云管理最佳实践，最好使用子域名，并使用逻辑和有效的DNS名称来划分您的集群，以便`kops`成功地发现它们。
- en: 'As an example, I will use the `k8s.containerized.me` subdomain as our hosted
    zone. Also, if your domain is registered with a registrar other than Amazon Route 53,
    you must update the name servers with your registrar and add Route 53 NS records
    for the hosted zone to your registrar''s DNS records:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我将使用`k8s.containerized.me`子域作为我们的托管区域。此外，如果您的域名是在Amazon Route 53之外的注册商注册的，您必须更新注册商的名称服务器，并为托管区域添加Route
    53 NS记录到您的注册商的DNS记录中：
- en: '[PRE8]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Create an S3 bucket to store the Kubernetes configuration and the state of
    the cluster. In our example, we will use `s3.k8s.containerized.me` as our bucket
    name:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个S3存储桶，用于存储Kubernetes配置和集群状态。在我们的示例中，我们将使用`s3.k8s.containerized.me`作为我们的存储桶名称：
- en: '[PRE9]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Confirm your S3 bucket by listing the available bucket:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过列出可用的存储桶来确认您的S3存储桶：
- en: '[PRE10]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Enable bucket versioning:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用存储桶版本控制：
- en: '[PRE11]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Set environmental parameters for `kops` so that you can use the locations by
    default:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置`kops`的环境参数，以便您可以默认使用位置：
- en: '[PRE12]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Create an SSH key if you haven''t done so already:'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您还没有创建SSH密钥，请创建一个：
- en: '[PRE13]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Create the cluster configuration with the list of zones where you want your
    master nodes to run:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用您希望主节点运行的区域列表创建集群配置：
- en: '[PRE14]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Create the cluster:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建集群：
- en: '[PRE15]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Wait a couple of minutes for the nodes to launch and validate:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 等待几分钟，直到节点启动并验证：
- en: '[PRE16]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Now, you can use `kubectl` to manage your cluster:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，您可以使用`kubectl`来管理您的集群：
- en: '[PRE17]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: By default, `kops` creates and exports the Kubernetes configuration under `~/.kube/config`.
    Therefore, no additional steps are required to connect your clusters using `kubectl`.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`kops`在`~/.kube/config`下创建和导出Kubernetes配置。因此，连接集群使用`kubectl`不需要额外的步骤。
- en: Provisioning a managed Kubernetes cluster on Amazon EKS
  id: totrans-80
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在Amazon EKS上创建托管的Kubernetes集群
- en: 'Perform the following steps to get your managed Kubernetes-as-a-service cluster
    up and running on Amazon EKS using `eksctl`:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤，在Amazon EKS上使用`eksctl`启动和运行您的托管Kubernetes服务集群：
- en: 'Create a cluster using the default settings:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用默认设置创建一个集群：
- en: '[PRE18]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: By default, `eksctl` deploys a cluster with workers on two `m5.large` instances
    using the AWS EKS AMI in the `us-west-2` region. `eksctl` creates and exports
    the Kubernetes configuration under `~/.kube/config`. Therefore, no additional
    steps are required to connect your clusters using `kubectl`.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`eksctl`使用AWS EKS AMI在`us-west-2`地区部署一个带有两个`m5.large`实例的集群。`eksctl`在`~/.kube/config`下创建和导出Kubernetes配置。因此，连接集群使用`kubectl`不需要额外的步骤。
- en: 'Confirm the cluster information and workers:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认集群信息和工作节点：
- en: '[PRE19]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Now, you have a two-node Amazon EKS cluster up and running.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您已经有一个运行中的双节点Amazon EKS集群。
- en: How it works...
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: The first recipe on Amazon EC2 showed you how to provision multiple copies of
    master nodes that can survive a master node failure as well as single AZ outages.
    Although it is similar to what you get with the second recipe on Amazon EKS with
    Multi-AZ support, clusters on EC2 give you higher flexibility. When you run Amazon
    EKS instead, it runs a single-tenant Kubernetes control plane for each cluster, and
    the control plane consists of at least two API server nodes and three `etcd` nodes
    that run across three AZs within a region.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在亚马逊EC2上的第一个配方向您展示了如何提供多个可以在主节点故障以及单个AZ故障中生存的主节点副本。虽然与亚马逊EKS的第二个配方中具有多AZ支持相似，但在EC2上的集群给您更高的灵活性。当您使用亚马逊EKS时，它为每个集群运行一个单租户Kubernetes控制平面，控制平面由至少两个API服务器节点和三个`etcd`节点组成，这些节点跨越区域内的三个AZ运行。
- en: 'Let''s take a look at the cluster options we used in s*tep 7* with the `kops
    create cluster` command:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看我们在第7步中使用的集群选项，使用 `kops create cluster` 命令：
- en: '`--node-count=3` sets the number of nodes to create. In our example, this is `6`. This
    configuration will deploy two nodes per zone defined with`--zones=us-east-1a,us-east-1b,us-east-1c`,
    with a total of three master nodes and six worker nodes.'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--node-count=3` 设置要创建的节点数。在我们的示例中，这是 `6`。这个配置将在定义的每个区域部署两个节点，使用`--zones=us-east-1a,us-east-1b,us-east-1c`，总共有三个主节点和六个工作节点。'
- en: '`--node-size` and `--master-size` set the instance size for the worker and
    master nodes. In our example, `t2.medium` is used for worker nodes and `t2.large` is
    used for master nodes. For larger clusters, `t2.large` is recommended for a worker.'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--node-size` 和 `--master-size` 设置了工作节点和主节点的实例大小。在我们的示例中，工作节点使用 `t2.medium`，主节点使用 `t2.large`。对于更大的集群，建议工作节点使用 `t2.large`。'
- en: '`--zones` and `--master-zones` set the zones that the cluster will run in.
    In our example, we have used three zones called `us-east-1a`, `us-east-1b`, and `us-east-1c`.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--zones` 和 `--master-zones` 设置了集群将在其中运行的区域。在我们的示例中，我们使用了三个区域，分别是 `us-east-1a`，`us-east-1b`，和 `us-east-1c`。'
- en: For additional zone information, check the AWS Global Infrastructure link in
    the*See also* section.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 有关额外区域信息，请查看*另请参阅* 部分中的AWS全球基础设施链接。
- en: AWS clusters cannot span across multiple regions and all the zones that have
    been defined for the master and worker nodes should be within the same region.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: AWS集群不能跨多个区域，所有已定义的主节点和工作节点的区域都应该在同一个区域内。
- en: When deploying multi-master clusters, an odd number of master instances should
    be created. Also, remember that Kubernetes relies on etcd, a distributed key/value
    store. etcd quorum requires more than 51% of the nodes to be available at any
    time. Therefore, with three master nodes, our control plane can only survive a
    single master node or AZ outages. If you need to handle more than that, you need
    to consider increasing the number of master instances.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在部署多主节点集群时，应创建奇数个主实例。还要记住，Kubernetes依赖于etcd，一个分布式键/值存储。etcd quorum要求超过51%的节点随时可用。因此，有三个主节点时，我们的控制平面只能在单个主节点或AZ故障时生存。如果需要处理更多情况，需要考虑增加主实例的数量。
- en: There's more…
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'It is also useful to have knowledge of the following information:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 还有以下信息也很有用：
- en: Using the AWS Shell
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用AWS Shell
- en: Using a gossip-based cluster
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用基于gossip的集群
- en: Using different regions for an S3 bucket
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在S3存储桶中使用不同的区域
- en: Editing cluster configuration
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编辑集群配置
- en: Deleting your cluster
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除您的集群
- en: Provisioning an EKS cluster using the Amazon EKS dashboard
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用亚马逊EKS仪表板来提供EKS集群
- en: Deploying Kubernetes Dashboard
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署Kubernetes仪表板
- en: Using the AWS Shell
  id: totrans-106
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用AWS Shell
- en: Another useful tool worth mentioning here is `aws-shell`. It is an integrated
    shell that works with the AWS CLI. It uses the AWS CLI configuration and improves
    productivity with an autocomplete feature.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里值得一提的另一个有用工具是`aws-shell`。它是一个与AWS CLI一起工作的集成式shell。它使用AWS CLI配置，并通过自动完成功能提高了生产力。
- en: 'Install `aws-shell` using the following command and run it:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令安装`aws-shell`并运行它：
- en: '[PRE20]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'You will see the following output:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 您将看到以下输出：
- en: '![](assets/5c520f0d-774a-4224-a917-223d3cbf2101.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/5c520f0d-774a-4224-a917-223d3cbf2101.png)'
- en: You can use AWS commands with `aws-shell` with less typing. Press the *F10* key
    to exit the shell.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用`aws-shell`与更少的输入来使用AWS命令。按*F10*键退出shell。
- en: Using a gossip-based cluster
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用基于八卦的集群
- en: In this recipe, we created a domain (either purchased from Amazon or another
    registrar) and a hosted zone, because kops uses DNS for discovery. Although it
    needs to be a valid DNS name, starting with kops 1.6.2, DNS configuration became
    optional. Instead of an actual domain or subdomain, a gossip-based cluster can
    be easily created. By using a registered domain name, we make our clusters easier
    to share and accessible by others for production use.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，我们创建了一个域（可以从亚马逊购买或其他注册商购买）和一个托管区域，因为kops使用DNS进行发现。虽然它需要是一个有效的DNS名称，但从kops
    1.6.2开始，DNS配置变成了可选项。可以轻松地创建一个基于八卦的集群，而不是实际的域或子域。通过使用注册的域名，我们使我们的集群更容易共享，并且可以被其他人用于生产。
- en: 'If, for any reason, you prefer a gossip-based cluster, you can skip hosted
    zone creation and use a cluster name that ends with `k8s.local` :'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 如果出于任何原因，您更喜欢基于八卦的集群，您可以跳过托管区域的创建，并使用以`k8s.local`结尾的集群名称：
- en: '[PRE21]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Setting the environmental parameters for `kops` is optional but highly recommended
    since it shortens your CLI commands.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 设置`kops`的环境参数是可选的，但强烈建议，因为它可以缩短您的CLI命令。
- en: Using different regions for an S3 bucket
  id: totrans-118
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 为S3存储桶使用不同的地区
- en: In order for kops to store cluster configuration, a dedicated S3 bucket is required.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 为了让kops存储集群配置，需要一个专用的S3存储桶。
- en: 'An example for the `eu-west-1` region would look as follows:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '`eu-west-1`地区的示例如下：'
- en: '[PRE22]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: This S3 bucket will become the source of truth for our Kubernetes cluster configuration.
    For simplicity, it is recommended to use the `us-east-1` region; otherwise, an
    appropriate `LocationConstraint` needs be specified in order to create the bucket
    in the desired region.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 这个S3存储桶将成为我们Kubernetes集群配置的真相来源。为了简单起见，建议使用`us-east-1`地区；否则，需要指定适当的`LocationConstraint`以便在所需的地区创建存储桶。
- en: Editing the cluster configuration
  id: totrans-123
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 编辑集群配置
- en: The `kops create cluster` command, which we used to create the cluster configuration, doesn't
    actually create the cluster itself and launch the EC2 instances; instead, it creates
    the configuration file in our S3 bucket.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '`kops create cluster`命令，我们用来创建集群配置，实际上并不创建集群本身并启动EC2实例；相反，它在我们的S3存储桶中创建配置文件。'
- en: After creating the configuration file, you can make changes to the configuration
    using the `kops edit cluster` command.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 创建配置文件后，您可以使用`kops edit cluster`命令对配置进行更改。
- en: 'You can separately edit your node instance groups using the following command:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下命令分别编辑您的节点实例组：
- en: '[PRE23]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The config file is called from the S3 bucket's state store location. If you
    prefer a different editor you can, for example, set `$KUBE_EDITOR=nano` to change
    it.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件是从S3存储桶的状态存储位置调用的。如果您喜欢不同的编辑器，您可以例如设置`$KUBE_EDITOR=nano`来更改它。
- en: Deleting your cluster
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 删除您的集群
- en: 'To delete your cluster, use the following command:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除您的集群，请使用以下命令：
- en: '[PRE24]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: This process may take a few minutes and, when finished, you will get a confirmation.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 这个过程可能需要几分钟，完成后，您将收到确认。
- en: Provisioning an EKS cluster using the Amazon EKS Management Console
  id: totrans-133
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用亚马逊EKS管理控制台配置EKS集群
- en: In the *Provisioning a managed Kubernetes cluster on Amazon EKS* recipe, we
    used eksctl to deploy a cluster. As an alternative, you can also use the AWS Management
    Console web user interface to deploy an EKS cluster.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在《在Amazon EKS上提供托管的Kubernetes集群》教程中，我们使用eksctl部署了一个集群。作为替代方案，您也可以使用AWS管理控制台Web用户界面来部署EKS集群。
- en: 'Perform the following steps to get your cluster up and running on Amazon EKS:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤来在Amazon EKS上启动和运行您的集群：
- en: Open your browser and go to the Amazon EKS console at [https://console.aws.amazon.com/eks/home#/clusters](https://console.aws.amazon.com/eks/home#/clusters).
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器并转到Amazon EKS控制台[https://console.aws.amazon.com/eks/home#/clusters](https://console.aws.amazon.com/eks/home#/clusters)。
- en: Enter a cluster name and click on the Next Step button.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入集群名称并点击“下一步”按钮。
- en: On the Create Cluster page, select Kubernetes Version, Role name, at least two
    or more availability zones from the subnets list, and Security groups.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建集群页面上，选择Kubernetes版本、角色名称、至少两个或更多可用区的子网列表和安全组。
- en: Click on Create.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击创建。
- en: Cluster creation with EKS takes around 20 minutes. Refresh the page in 15-20
    minutes and check its status.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用EKS创建集群大约需要20分钟。在15-20分钟后刷新页面并检查其状态。
- en: 'Use the following command to update your `kubectl` configuration:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令更新您的`kubectl`配置：
- en: '[PRE25]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Now, use `kubectl` to manage your cluster:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，使用`kubectl`来管理您的集群：
- en: '[PRE26]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Now that your cluster has been configured, you can configure `kubectl` to manage
    it.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您的集群已配置好，您可以配置`kubectl`来管理它。
- en: Deploying Kubernetes Dashboard
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 部署Kubernetes仪表板
- en: 'Last but not least, to deploy the Kubernetes Dashboard application on an AWS
    cluster, you need to follow these steps:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 最后但并非最不重要的是，在AWS集群上部署Kubernetes仪表板应用程序，您需要按照以下步骤进行操作：
- en: 'At the time I wrote this recipe, Kubernetes Dashboard v.2.0.0 was still in
    beta. Since v.1.x version will be obsolete soon, I highly recommend that you install
    the latest version, that is, v.2.0.0\. The new version brings a lot of functionality
    and support for Kubernetes v.1.16 and later versions. Before you deploy Dashboard,
    make sure to remove the previous version if you have a previous version. Check
    the latest release by following the link in the following information box and
    deploy it using the latest release, similar to doing the following:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我写这个教程的时候，Kubernetes Dashboard v.2.0.0仍处于测试阶段。由于v.1.x版本很快就会过时，我强烈建议您安装最新版本，即v.2.0.0。新版本带来了许多功能和对Kubernetes
    v.1.16及更高版本的支持。在部署仪表板之前，请确保删除之前的版本（如果有）。通过以下信息框中的链接检查最新发布，并使用最新发布进行部署，类似于以下操作：
- en: '[PRE27]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'As the Kubernetes version gets upgraded, the dashboard application also gets
    frequently updated. To use the latest version, find the latest link to the YAML
    manifest on the release page at [https://github.com/kubernetes/dashboard/releases](https://github.com/kubernetes/dashboard/releases).
    If you experience compatibility issues with the latest version of Dashboard, you
    can always deploy the previous stable version by using the following command:
    `$ kubectl apply -f`'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 随着Kubernetes版本的升级，仪表板应用程序也经常会更新。要使用最新版本，请在发布页面[https://github.com/kubernetes/dashboard/releases](https://github.com/kubernetes/dashboard/releases)上找到YAML清单的最新链接。如果您在使用仪表板的最新版本时遇到兼容性问题，您可以始终使用以下命令部署以前的稳定版本：`$
    kubectl apply -f`
- en: '`https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/depl`'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '`https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/depl`'
- en: '`oy/recommended/kubernetes-dashboard.yaml`'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '`oy/recommended/kubernetes-dashboard.yaml`'
- en: 'By default, the `kubernetes-dashboard` service is exposed using the `ClusterIP`
    type. If you want to access it from outside, edit the service using the following
    command and replace the `ClusterIP` type with `LoadBalancer`; otherwise, use port
    forwarding to access it:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认情况下，`kubernetes-dashboard`服务使用`ClusterIP`类型进行公开。如果您想从外部访问它，请使用以下命令编辑服务，并将`ClusterIP`类型替换为`LoadBalancer`；否则，请使用端口转发进行访问：
- en: '[PRE28]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Get the external IP of your dashboard from the `kubernetes-dashboard` service:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`kubernetes-dashboard`服务中获取仪表板的外部IP：
- en: '[PRE29]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Open the external IP link in your browser. In our example, it is `https://myaddress.us-east-1.elb.amazonaws.com`.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在浏览器中打开外部IP链接。在我们的示例中，它是`https://myaddress.us-east-1.elb.amazonaws.com`。
- en: 'We will use the token option to access Kubernetes Dashboard. Now, let''s find
    the token in our cluster using the following command. In this example, the command
    returns `kubernetes-dashboard-token-bc2w5` as the token name:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用令牌选项来访问Kubernetes仪表板。现在，让我们使用以下命令在我们的集群中找到令牌。在这个例子中，该命令返回`kubernetes-dashboard-token-bc2w5`作为令牌名称：
- en: '[PRE30]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Replace the secret name with yours from the output of the previous command.
    Get the token details from the description of the Secret:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用前一个命令的输出替换密钥名称。从Secret的描述中获取令牌详细信息：
- en: '[PRE31]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Copy the token section from the output of the preceding command and paste it
    into Kubernetes Dashboard to sign in to Dashboard:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从前面命令的输出中复制令牌部分，并将其粘贴到Kubernetes仪表板中以登录到仪表板：
- en: '![](assets/2d90464c-0905-4590-a4c6-4a2da4455555.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/2d90464c-0905-4590-a4c6-4a2da4455555.png)'
- en: Now, you have access to Kubernetes Dashboard to manage your cluster.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以访问Kubernetes仪表板来管理您的集群。
- en: See also
  id: totrans-165
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: 'Kops documentation for the latest version and additional `create cluster` parameters:'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最新版本和额外的`create cluster`参数的Kops文档：
- en: '[https://github.com/kubernetes/kops/blob/master/docs/aws.md](https://github.com/kubernetes/kops)'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/kubernetes/kops/blob/master/docs/aws.md](https://github.com/kubernetes/kops)'
- en: '[https://github.com/kubernetes/kops/blob/master/docs/cli/kops_create_cluster.md](https://github.com/kubernetes/kops/blob/master/docs/cli/kops_create_cluster.md)'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/kubernetes/kops/blob/master/docs/cli/kops_create_cluster.md](https://github.com/kubernetes/kops/blob/master/docs/cli/kops_create_cluster.md)'
- en: 'AWS Command Reference S3 Create Bucket API: [https://docs.aws.amazon.com/cli/latest/reference/s3api/create-bucket.html](https://docs.aws.amazon.com/cli/latest/reference/s3api/create-bucket.html)'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS命令参考S3创建存储桶API：[https://docs.aws.amazon.com/cli/latest/reference/s3api/create-bucket.html](https://docs.aws.amazon.com/cli/latest/reference/s3api/create-bucket.html)
- en: AWS Global Infrastructure Map: [https://aws.amazon.com/about-aws/global-infrastructure/ ](https://aws.amazon.com/about-aws/global-infrastructure/)
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS全球基础设施地图： [https://aws.amazon.com/about-aws/global-infrastructure/ ](https://aws.amazon.com/about-aws/global-infrastructure/)
- en: Amazon EKS FAQ: [https://aws.amazon.com/eks/faqs/](https://aws.amazon.com/eks/faqs/)
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Amazon EKS常见问题： [https://aws.amazon.com/eks/faqs/](https://aws.amazon.com/eks/faqs/)
- en: The AWS Fargate product, another AWS service, if you would prefer to run containers
    without managing servers or clusters: [https://aws.amazon.com/fargate/](https://aws.amazon.com/fargate/)
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS Fargate产品，另一个AWS服务，如果您希望在不管理服务器或集群的情况下运行容器： [https://aws.amazon.com/fargate/](https://aws.amazon.com/fargate/)
- en: A complete list of CNCF-certified Kubernetes installers: [https://landscape.cncf.io/category=certified-kubernetes-installer&format=card-mode&grouping=category](https://landscape.cncf.io/category=certified-kubernetes-installer&format=card-mode&grouping=category).
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CNCF认证的Kubernetes安装程序的完整列表： [https://landscape.cncf.io/category=certified-kubernetes-installer&format=card-mode&grouping=category](https://landscape.cncf.io/category=certified-kubernetes-installer&format=card-mode&grouping=category)。
- en: 'Other recommended tools for getting highly available clusters on AWS:'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在AWS上获取高可用集群的其他推荐工具：
- en: Konvoy: [https://d2iq.com/solutions/ksphere/konvoy](https://d2iq.com/solutions/ksphere/konvoy)
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Konvoy: [https://d2iq.com/solutions/ksphere/konvoy](https://d2iq.com/solutions/ksphere/konvoy)
- en: KubeAdm: [https://github.com/kubernetes/kubeadm ](https://github.com/kubernetes/kubeadm)
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'KubeAdm: [https://github.com/kubernetes/kubeadm ](https://github.com/kubernetes/kubeadm)'
- en: KubeOne: [https://github.com/kubermatic/kubeone](https://github.com/kubermatic/kubeone)
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'KubeOne: [https://github.com/kubermatic/kubeone](https://github.com/kubermatic/kubeone)'
- en: KubeSpray: [https://github.com/kubernetes-sigs/kubespray](https://github.com/kubernetes-sigs/kubespray)
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'KubeSpray: [https://github.com/kubernetes-sigs/kubespray](https://github.com/kubernetes-sigs/kubespray)'
- en: Configuring a Kubernetes cluster on Google Cloud Platform
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Google Cloud Platform上配置Kubernetes集群
- en: This section will take you through step-by-step instructions to configure Kubernetes
    clusters on GCP. You will learn how to run a hosted Kubernetes cluster without
    needing to provision or manage master and etcd instances using GKE.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将逐步指导您在GCP上配置Kubernetes集群。您将学习如何在不需要配置或管理主节点和etcd实例的情况下运行托管的Kubernetes集群，使用GKE。
- en: Getting ready
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: All the operations mentioned here require a GCP account with billing enabled.
    If you don't have one already, go to [https://console.cloud.google.com](https://console.cloud.google.com) and
    create an account.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 这里提到的所有操作都需要启用计费的GCP帐户。如果您还没有，请转到[https://console.cloud.google.com](https://console.cloud.google.com)并创建一个帐户。
- en: On **Google Cloud Platform** (**GCP**), you have two main options when it comes
    to running Kubernetes. You can consider using **Google Compute Engine** (**GCE**)
    if you'd like to manage your deployment completely and have specific powerful
    instance requirements. Otherwise, it's highly recommended to use the managed **Google
    Kubernetes Engine** (**GKE**).
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在Google Cloud Platform（GCP）上，运行Kubernetes有两个主要选项。如果您想完全管理部署并具有特定的强大实例要求，可以考虑使用Google
    Compute Engine（GCE）。否则，强烈建议使用托管的Google Kubernetes Engine（GKE）。
- en: How to do it…
  id: totrans-184
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'This section is further divided into the following subsections to make this
    process easier to follow:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 本节进一步分为以下小节，以使此过程更易于跟进：
- en: Installing the command-line tools to configure GCP services
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装命令行工具以配置GCP服务
- en: Provisioning a managed Kubernetes cluster on GKE
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在GKE上配置托管的Kubernetes集群
- en: Connecting to GKE clusters
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接到GKE集群
- en: Installing the command-line tools to configure GCP services
  id: totrans-189
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装命令行工具以配置GCP服务
- en: 'In this recipe, we will get the primary CLI for Google Cloud Platform, `gcloud`, installed
    so that we can configure GCP services:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，我们将安装Google云平台的主要CLI，`gcloud`，以便我们可以配置GCP服务：
- en: 'Run the following command to download the `gcloud` CLI:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令以下载`gcloud` CLI：
- en: '[PRE32]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Initialize the SDK and follow the instructions given:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 初始化SDK并按照给定的说明进行操作：
- en: '[PRE33]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: During the initialization, when asked, select either an existing project that
    you have permissions for or create a new project.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在初始化期间，当询问时，请选择您有权限的现有项目或创建一个新项目。
- en: 'Enable the Compute Engine APIs for the project:'
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为项目启用Compute Engine API：
- en: '[PRE34]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Set a default zone:'
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置默认区域：
- en: '[PRE35]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Make sure you can start up a GCE instance from the command line:'
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保您可以从命令行启动GCE实例：
- en: '[PRE36]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Delete the test VM:'
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除测试VM：
- en: '[PRE37]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: If all the commands are successful, you can provision your GKE cluster.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 如果所有命令都成功，您可以配置您的GKE集群。
- en: Provisioning a managed Kubernetes cluster on GKE
  id: totrans-205
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在GKE上配置托管的Kubernetes集群
- en: 'Let''s perform the following steps:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下步骤：
- en: 'Create a cluster:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个集群：
- en: '[PRE38]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Cluster creation will take 5 minutes or more to complete.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 集群创建需要5分钟或更长时间才能完成。
- en: Connecting to Google Kubernetes Engine (GKE) clusters
  id: totrans-210
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接到Google Kubernetes Engine（GKE）集群
- en: 'To get access to your GKE cluster, you need to follow these steps:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 要访问您的GKE集群，您需要按照以下步骤进行操作：
- en: 'Configure `kubectl` to access your `k8s-devops-cookbook-1` cluster:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置`kubectl`以访问您的`k8s-devops-cookbook-1`集群：
- en: '[PRE39]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Verify your Kubernetes cluster:'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证您的Kubernetes集群：
- en: '[PRE40]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Now, you have a three-node GKE cluster up and running.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您有一个运行中的三节点GKE集群。
- en: How it works…
  id: totrans-217
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: This recipe showed you how to quickly provision a GKE cluster using some default
    parameters.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 这个教程向您展示了如何使用一些默认参数快速配置 GKE 集群。
- en: In *Step 1,* we created a cluster with some default parameters*.* While all
    of the parameters are very important, I want to explain some of them here.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *步骤 1* 中，我们使用了一些默认参数创建了一个集群。虽然所有参数都非常重要，但我想在这里解释其中一些。
- en: '`--cluster-version` sets the Kubernetes version to use for the master and nodes.
    Only use it if you want to use a version that''s different from the default. To
    get the available version information, you can use the `gcloud container get-server-config` command.'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: '`--cluster-version` 设置要用于主节点和节点的 Kubernetes 版本。只有在想要使用与默认值不同的版本时才使用它。您可以使用
    `gcloud container get-server-config` 命令获取可用版本信息。'
- en: We set the instance type by using the `--machine-type` parameter. If it's not
    set, the default is `n1-standard-1`. To get the list of predefined types, you
    can use the `gcloud compute machine-types list` command.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用 `--machine-type` 参数设置了实例类型。如果没有设置，默认值是 `n1-standard-1`。您可以使用 `gcloud compute
    machine-types list` 命令获取预定义类型的列表。
- en: The default image type is COS, but my personal preference is Ubuntu, so I used `--image-type
    UBUNTU` to set the OS image to `UBUNTU`. If this isn't set, the server picks the
    default image type, that is, COS. To get the list of available image types, you
    can use the `gcloud container get-server-config` command.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 默认镜像类型是 COS，但我个人偏好 Ubuntu，所以我使用 `--image-type UBUNTU` 来将 OS 镜像设置为 `UBUNTU`。如果没有设置，服务器会选择默认镜像类型，即
    COS。您可以使用 `gcloud container get-server-config` 命令获取可用镜像类型的列表。
- en: GKE offers advanced cluster management features and comes with the automatic
    scaling of node instances, auto-upgrade, and auto-repair to maintain node availability. `--enable-autoupgrade`
    enables the GKE auto-upgrade feature for cluster nodes and `--enable-autorepair`
    enables the automatic repair feature, which is started at the time defined with
    the `--maintenance-window` parameter. The time that's set here is the UTC time
    zone and must be in `HH:MM` format.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: GKE 提供了高级集群管理功能，并配备了节点实例的自动扩展、自动升级和自动修复功能，以维护节点的可用性。`--enable-autoupgrade` 启用了
    GKE 的自动升级功能，用于集群节点，`--enable-autorepair` 启用了自动修复功能，该功能在使用 `--maintenance-window`
    参数定义的时间开始。这里设置的时间是 UTC 时区，并且必须以 `HH:MM` 格式。
- en: There's more…
  id: totrans-224
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'The following are some of the alternative methods that can be employed besides
    the recipe described in the previous section:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在上一节描述的教程之外可以采用的一些替代方法：
- en: Using Google Cloud Shell
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Google 云 Shell
- en: Deploying with a custom network configuration
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用自定义网络配置部署
- en: Deleting your cluster
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除您的集群
- en: Viewing the Workloads dashboard
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看工作负载仪表板
- en: Using Google Cloud Shell
  id: totrans-230
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 Google 云 Shell
- en: As an alternative to your Linux workstation, you can get a CLI interface on
    your browser to manage your cloud instances.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 作为 Linux 工作站的替代方案，您可以在浏览器上获得 CLI 接口，以管理您的云实例。
- en: Go to [https://cloud.google.com/shell/](https://cloud.google.com/shell/) to
    get a Google Cloud Shell.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 转到 [https://cloud.google.com/shell/](https://cloud.google.com/shell/) 获取 Google
    云 Shell。
- en: Deploying with a custom network configuration
  id: totrans-233
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用自定义网络配置部署
- en: 'The following steps demonstrate how to provision your cluster with a custom
    network configuration:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤演示了如何使用自定义网络配置来配置您的集群：
- en: 'Create a VPC network:'
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 VPC 网络：
- en: '[PRE41]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Create a subnet in your VPC network. In our example, this is `10.240.0.0/16`:'
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的 VPC 网络中创建一个子网。在我们的示例中，这是 `10.240.0.0/16`：
- en: '[PRE42]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Create a firewall rule to allow internal traffic:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建防火墙规则以允许内部流量：
- en: '[PRE43]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Create a firewall rule to allow external SSH, ICMP, and HTTPS traffic:'
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建防火墙规则以允许外部 SSH、ICMP 和 HTTPS 流量：
- en: '[PRE44]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Verify the rules:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证规则：
- en: '[PRE45]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Add the `--network k8s-devops-cookbook` and `--subnetwork kubernetes` parameters
    to your `container clusters create` command and run it.
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`--network k8s-devops-cookbook`和`--subnetwork kubernetes`参数添加到您的`container
    clusters create`命令并运行它。
- en: Deleting your cluster
  id: totrans-246
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 删除您的集群
- en: 'To delete your `k8s-devops-cookbook-1` cluster, use the following command:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除您的`k8s-devops-cookbook-1`集群，请使用以下命令：
- en: '[PRE46]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: This process may take a few minutes and when finished, you will get a confirmation
    message.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 这个过程可能需要几分钟，完成后，您将收到确认消息。
- en: Viewing the Workloads dashboard
  id: totrans-250
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 查看工作负载仪表板
- en: 'On GCP, instead of using the Kubernetes Dashboard application, you can use
    the built-in Workloads dashboard and deploy containerized applications through
    Google Marketplace. Follow these steps:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 在GCP上，您可以使用内置的工作负载仪表板并通过Google Marketplace部署容器化应用程序，而不是使用Kubernetes仪表板应用程序。按照以下步骤：
- en: To access the Workload dashboard from your GCP dashboard, choose your GKE cluster
    and click on Workloads.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要从GCP仪表板访问工作负载仪表板，请选择您的GKE集群并单击工作负载。
- en: Click on Show system workloads to see the existing components and containers
    that have been deployed in the `kube-system` namespace.
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“显示系统工作负载”以查看已部署在`kube-system`命名空间中的现有组件和容器。
- en: See also
  id: totrans-254
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: The GCP documentation: [https://cloud.google.com/docs/](https://cloud.google.com/docs/)
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GCP文档：[https://cloud.google.com/docs/](https://cloud.google.com/docs/)
- en: 'GKE on-prem installation: [https://cloud.google.com/gke-on-prem/docs/how-to/install-overview-basic](https://cloud.google.com/gke-on-prem/docs/how-to/install-overview-basic)'
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GKE本地安装：[https://cloud.google.com/gke-on-prem/docs/how-to/install-overview-basic](https://cloud.google.com/gke-on-prem/docs/how-to/install-overview-basic)
- en: Configuring a Kubernetes cluster on Microsoft Azure
  id: totrans-257
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Microsoft Azure上配置Kubernetes集群
- en: In this section, we will cover a recipe using Microsoft **Azure Kubernetes Service**
    (**AKS**) in order to create a Kubernetes cluster on the Microsoft Azure Cloud.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将使用Microsoft **Azure Kubernetes Service**（**AKS**）创建Microsoft Azure云上的Kubernetes集群。
- en: Getting ready
  id: totrans-259
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: All the operations mentioned here require a Microsoft Azure subscription. If
    you don't have one already, go to [https://portal.azure.com](https://portal.azure.com)[ ](https://portal.azure.com)and
    create a free account.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 这里提到的所有操作都需要Microsoft Azure订阅。如果您还没有，请转到[https://portal.azure.com](https://portal.azure.com)并创建一个免费帐户。
- en: How to do it…
  id: totrans-261
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'This section will take you through how to configure a Kubernetes cluster on
    Microsoft Azure. This section is further divided into the following subsections
    to make this process easier:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将带您了解如何在Microsoft Azure上配置Kubernetes集群。本节进一步分为以下子节，以使此过程更容易：
- en: Installing the command-line tools to configure Azure services
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装命令行工具以配置Azure服务
- en: Provisioning a managed Kubernetes cluster on AKS
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在AKS上配置托管的Kubernetes集群
- en: Connecting to AKS clusters
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接到AKS集群
- en: Installing the command-line tools to configure Azure services
  id: totrans-266
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装命令行工具以配置Azure服务
- en: In this recipe, we will get the Azure CLI tool called `az` and `kubectl` installed.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个配方中，我们将安装名为`az`和`kubectl`的Azure CLI工具。
- en: 'Let''s perform the following steps:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下步骤：
- en: 'Install the necessary dependencies:'
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装必要的依赖项：
- en: '[PRE47]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Download and install the `az` CLI tool:'
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载并安装`az` CLI工具：
- en: '[PRE48]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Verify the `az` version you''re using:'
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证您正在使用的`az`版本：
- en: '[PRE49]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Install `kubectl`, if you haven''t installed it already:'
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果尚未安装，请安装`kubectl`：
- en: '[PRE50]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: If all commands were successful, you can start provisioning your AKS cluster.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 如果所有命令都成功，您可以开始配置您的AKS集群。
- en: Provisioning a managed Kubernetes cluster on AKS
  id: totrans-278
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在AKS上配置托管的Kubernetes集群
- en: 'Let''s perform the following steps:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下步骤：
- en: 'Log in to your account:'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到您的帐户：
- en: '[PRE51]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Create a resource group named `k8sdevopscookbook` in your preferred region:'
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您喜欢的区域创建一个名为`k8sdevopscookbook`的资源组：
- en: '[PRE52]'
  id: totrans-283
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Create a service principal and take note of your `appId` and `password` for
    the next steps:'
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建服务主体并记下您的`appId`和`password`以进行下一步：
- en: '[PRE53]'
  id: totrans-285
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Create a cluster. Replace `appId` and `password` with the output from the preceding
    command:'
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个集群。用前面命令的输出替换`appId`和`password`：
- en: '[PRE54]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Cluster creation will take around 5 minutes. You will see `"provisioningState":
    Succeeded"` when it has successfully completed.'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: '集群创建大约需要5分钟。当成功完成时，您将看到`"provisioningState": Succeeded"`。'
- en: Connecting to AKS clusters
  id: totrans-289
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接到AKS集群
- en: 'Let''s perform the following steps:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下步骤：
- en: 'Gather some credentials and configure `kubectl` so that you can use them:'
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 收集一些凭据并配置`kubectl`以便您可以使用它们：
- en: '[PRE55]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Verify your Kubernetes cluster:'
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证您的Kubernetes集群：
- en: '[PRE56]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Now, you have a three-node GKE cluster up and running.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您有一个运行中的三节点GKE集群。
- en: How it works…
  id: totrans-296
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: This recipe showed you how to quickly provision an AKS cluster using some common
    options.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 本教程向您展示了如何使用一些常见选项快速创建AKS集群。
- en: In *step 3*, the command starts with `az aks create`, followed by `-g` or `--resource-group`,
    so that you can select the name of your resource group. You can configure the
    default group using `az configure --defaults group=k8sdevopscookbook` and skip
    this parameter next time.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤3*中，命令以`az aks create`开头，后面跟着`-g`或`--resource-group`，这样您就可以选择资源组的名称。您可以使用`az
    configure --defaults group=k8sdevopscookbook`来配置默认组，并在下次跳过这个参数。
- en: We used the `--name AKSCluster` parameter to set the name of the managed cluster
    to `AKSCluster`. The rest of the parameters are optional; `--kubernetes-version`
    or `-k` sets the version of Kubernetes to use for the cluster. You can use the
    `az aks get-versions --location eastus --output table` command to get the list
    of available options.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用`--name AKSCluster`参数来设置托管集群的名称为`AKSCluster`。其余的参数是可选的；`--kubernetes-version`或`-k`设置要用于集群的Kubernetes版本。您可以使用`az
    aks get-versions --location eastus --output table`命令来获取可用选项的列表。
- en: We used `--node-vm-size` to set the instance type for the Kubernetes worker
    nodes. If this isn't set, the default is `Standard_DS2_v2`.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用`--node-vm-size`来设置Kubernetes工作节点的实例类型。如果没有设置，默认值为`Standard_DS2_v2`。
- en: Next, we used `--node-count` to set the number of Kubernetes worker nodes. If
    this isn't set, the default is `3`. This can be changed using the `az aks scale` command.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们使用`--node-count`来设置Kubernetes工作节点的数量。如果没有设置，默认值为`3`。可以使用`az aks scale`命令来更改这个值。
- en: Finally, the `--generate-ssh-keys` parameter is used to autogenerate the SSH
    public and private key files, which are stored in the `~/.ssh` directory.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，使用`--generate-ssh-keys`参数来自动生成SSH公钥和私钥文件，这些文件存储在`~/.ssh`目录中。
- en: There's more…
  id: totrans-303
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: 'Although Windows-based containers are now supported by Kubernetes, to be able
    to run Windows Server containers, you need to run Windows Server-based nodes.
    AKS nodes currently run on Linux OS and Windows Server-based nodes are not available
    in AKS. However, you can use Virtual Kubelet to schedule Windows containers on
    container instances and manage them as part of your cluster. In this section,
    we will take a look at the following:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管Kubernetes现在支持基于Windows的容器，但要能够运行Windows Server容器，您需要运行基于Windows Server的节点。AKS节点目前在Linux
    OS上运行，不支持基于Windows Server的节点。但是，您可以使用Virtual Kubelet在容器实例上调度Windows容器，并将其作为集群的一部分进行管理。在本节中，我们将看一下以下内容：
- en: Deleting your cluster
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除您的集群
- en: Viewing Kubernetes Dashboard
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看Kubernetes仪表板
- en: Deleting your cluster
  id: totrans-307
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 删除您的集群
- en: 'To delete your cluster, use the following command:'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除您的集群，请使用以下命令：
- en: '[PRE57]'
  id: totrans-309
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: This process will take a few minutes and, when finished, you will receive confirmation
    of this.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 这个过程将需要几分钟，完成后，您将收到确认信息。
- en: Viewing Kubernetes Dashboard
  id: totrans-311
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 查看Kubernetes仪表板
- en: 'To view Kubernetes Dashboard, you need to follow these steps:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看Kubernetes仪表板，您需要按照以下步骤进行：
- en: 'To start Kubernetes Dashboard, use the following command:'
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要启动Kubernetes仪表板，请使用以下命令：
- en: '[PRE58]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'If your cluster is RBAC-enabled, then create `Clusterrolebinding`:'
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您的集群启用了RBAC，则创建`Clusterrolebinding`：
- en: '[PRE59]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Open a browser window and go to the address where the proxy is running. In our
    example, this is `http://127.0.0.1:8001/`.
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器窗口，转到代理运行的地址。在我们的示例中，这是`http://127.0.0.1:8001/`。
- en: See also
  id: totrans-318
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: Microsoft AKS FAQ: [https://docs.microsoft.com/en-us/azure/aks/faq](https://docs.microsoft.com/en-us/azure/aks/faq)
  id: totrans-319
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft AKS FAQ：[https://docs.microsoft.com/en-us/azure/aks/faq](https://docs.microsoft.com/en-us/azure/aks/faq)
- en: Repository of the open source core of AKS on GitHub: [https://github.com/Azure/aks-engine](https://github.com/Azure/aks-engine)
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在GitHub上的AKS开源核心存储库：[https://github.com/Azure/aks-engine](https://github.com/Azure/aks-engine)
- en: Configuring a Kubernetes cluster on Alibaba Cloud
  id: totrans-321
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在阿里巴巴云上配置Kubernetes集群
- en: 'Alibaba Cloud (also known as Aliyun) offers multiple templates that you can
    use to provision a Kubernetes environment. There are four main service categories:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 阿里巴巴云（也称为阿里云）提供了多个模板，您可以使用这些模板来提供Kubernetes环境。有四个主要的服务类别：
- en: 'Kubernetes: Self-managed Kubernetes deployed with three masters on ECS instances
    within a single zone. Worker nodes can be on either ECS or bare-metal.'
  id: totrans-323
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kubernetes：在单个区域的ECS实例上部署的具有三个主节点的自管理Kubernetes。工作节点可以是ECS或裸金属。
- en: Managed Kubernetes: Similar to the Kubernetes cluster option, except master
    nodes are managed by Alibaba Cloud.
  id: totrans-324
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 托管的Kubernetes：类似于Kubernetes集群选项，只是主节点由阿里巴巴云管理。
- en: Multi-AZ Kubernetes: Similar to the Kubernetes cluster option, except the self-managed
    master and worker instances can be deployed in separate availability zones.
  id: totrans-325
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多AZ Kubernetes：类似于Kubernetes集群选项，只是自管理的主节点和工作节点可以部署在不同的可用区。
- en: 'Serverless Kubernetes: A Kubernetes service offering where you deploy container
    applications without having to manage and maintain clusters instances:'
  id: totrans-326
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无服务器Kubernetes：一种Kubernetes服务提供，您可以在其中部署容器应用程序，而无需管理和维护集群实例：
- en: '![](assets/d5d00123-6c97-4086-b3df-8808269e905b.png)'
  id: totrans-327
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/d5d00123-6c97-4086-b3df-8808269e905b.png)'
- en: In this section, we will cover how to provision a highly available Multi-AZ
    Kubernetes cluster without needing to provision or manage master and etcd instances.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍如何在不需要配置或管理主节点和etcd实例的情况下，提供一个高可用的多AZ Kubernetes集群。
- en: Getting ready
  id: totrans-329
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 做好准备
- en: All the operations mentioned here require an Alibaba Cloud account (also known
    as Aliyun) with an AccessKey. If you don't have one already, go to [https://account.alibabacloud.com](https://account.alibabacloud.com) and
    create an account.
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 这里提到的所有操作都需要阿里巴巴云账户（也称为阿里云）和AccessKey。如果您还没有，请转到[https://account.alibabacloud.com](https://account.alibabacloud.com)并创建一个账户。
- en: How to do it…
  id: totrans-331
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到…
- en: 'This section will take you through how to configure a Kubernetes cluster on
    Alibaba Cloud. This section is further divided into the following subsections
    to make this process easier:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将带您了解如何在阿里巴巴云上配置Kubernetes集群。本节进一步分为以下子节，以使此过程更加简单：
- en: Installing the command-line tools to configure Alibaba Cloud services
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装命令行工具以配置阿里巴巴云服务
- en: Provisioning a highly available Kubernetes cluster on Alibaba Cloud
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在阿里巴巴云上提供一个高可用的Kubernetes集群
- en: Connecting to Alibaba Container Service clusters
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接到阿里巴巴容器服务集群
- en: Installing the command-line tools to configure Alibaba Cloud services
  id: totrans-336
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装命令行工具以配置阿里巴巴云服务
- en: For this recipe, we will use the Alibaba Cloud console and generate the API
    request parameters from the dashboard that will be used with the CLI. You will
    also need the Alibaba Cloud CLI, `aliyun`, and `kubectl` installed.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 对于此示例，我们将使用阿里巴巴云控制台，并从仪表板生成API请求参数，该参数将与CLI一起使用。您还需要安装阿里巴巴云CLI `aliyun`和`kubectl`。
- en: 'Run the following command to download the `aliyun` tool:'
  id: totrans-338
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令以下载`aliyun`工具：
- en: '[PRE60]'
  id: totrans-339
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: You can find the link to the latest version here: [https://github.com/aliyun/aliyun-cli](https://github.com/aliyun/aliyun-cli).
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在此处找到最新版本的链接：[https://github.com/aliyun/aliyun-cli](https://github.com/aliyun/aliyun-cli)。
- en: 'Extract the files and install them:'
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提取文件并安装它们：
- en: '[PRE61]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Verify the `aliyun` CLI version you''re using:'
  id: totrans-343
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证您正在使用的`aliyun` CLI版本：
- en: '[PRE62]'
  id: totrans-344
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: If you haven't created an AccessKey, go to Security Management in your account
    and create one ([https://usercenter.console.aliyun.com/#/manage/ak](https://account.alibabacloud.com/login/login.htm?spm=a2c44.11131515.0.0.4e57525cYlZEdf)).
  id: totrans-345
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您还没有创建AccessKey，请转到您的帐户中的安全管理并创建一个([https://usercenter.console.aliyun.com/#/manage/ak](https://account.alibabacloud.com/login/login.htm?spm=a2c44.11131515.0.0.4e57525cYlZEdf))。
- en: 'Complete the CLI configuration by entering your AccessKey ID, AccessKey Secret,
    and region ID:'
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过输入您的AccessKey ID、AccessKey Secret和区域ID完成CLI配置：
- en: '[PRE63]'
  id: totrans-347
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Enable `bash/zsh` autocompletion:'
  id: totrans-348
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用`bash/zsh`自动完成：
- en: '[PRE64]'
  id: totrans-349
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: Go to the Container Service console ([https://cs.console.aliyun.com](https://cs.console.aliyun.com))
    to give permissions to the container service to access cloud resources. Here,
    select `AliyunCSDefaultRole`, `AliyunCSServerlessKuberentesRole`, `AliyunCSClusterRole`,
    and `AliyunCSManagedKubernetesRole` and click on Confirm Authorization Policy.
  id: totrans-350
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到容器服务控制台([https://cs.console.aliyun.com](https://cs.console.aliyun.com))，为容器服务授予权限访问云资源。在这里，选择`AliyunCSDefaultRole`、`AliyunCSServerlessKuberentesRole`、`AliyunCSClusterRole`和`AliyunCSManagedKubernetesRole`，然后点击“确认授权策略”。
- en: Make sure you have the **Resource Orchestration Service** (**ROS**) and Autoscaling
    services enabled since they are required to get Kubernetes clusters deployed.
    ROS is used to automatically provision and configure resources for auto-deployment,
    operation, and maintenance based on your template, while Autoscaling is used to
    adjust compute resources based on demand.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 确保已启用**资源编排服务（ROS）**和自动伸缩服务，因为它们是部署Kubernetes集群所需的。ROS用于根据您的模板自动提供和配置资源以进行自动部署、操作和维护，而自动伸缩用于根据需求调整计算资源。
- en: Provisioning a highly available Kubernetes cluster on Alibaba Cloud
  id: totrans-352
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在阿里云上部署高可用的Kubernetes集群
- en: 'Let''s perform the following steps:'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下步骤：
- en: Open a browser window and go to the Alibaba Cloud Virtual Private Cloud console
    at [https://vpc.console.aliyun.com](https://vpc.console.aliyun.com).
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器窗口，转到阿里云虚拟私有云控制台[https://vpc.console.aliyun.com](https://vpc.console.aliyun.com)。
- en: Make sure you select a region with at least three zones (most of the regions
    in mainland China have more than three zones) and click on Create VPC.
  id: totrans-355
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保选择至少有三个区域的区域（中国大陆的大多数区域都有三个以上的区域），然后点击“创建VPC”。
- en: Give a unique name to your VPC and select an IPv4 CIDR block. In our example, this
    is `10.0.0.0/8`.
  id: totrans-356
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为您的VPC指定一个唯一名称并选择一个IPv4 CIDR块。在我们的示例中，这是`10.0.0.0/8`。
- en: Enter a name for your first VSwitch ( `k8s-1`), and select a zone (`Beijing
    Zone A`).
  id: totrans-357
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为您的第一个VSwitch（`k8s-1`）输入一个名称，并选择一个区域（`北京A区`）。
- en: Set an IPv4 CIDR block. In our example, we used `10.10.0.0./16`.
  id: totrans-358
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置一个IPv4 CIDR块。在我们的示例中，我们使用了`10.10.0.0./16`。
- en: 'Click on the Add button and repeat *steps 4* and *5* to get different zones.
    Use the following CIDR block information:'
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“添加”按钮，然后重复*步骤4*和*步骤5*以获取不同的区域。使用以下CIDR块信息：
- en: '|  | **VSwitch 2** | **VSwitch 3** |'
  id: totrans-360
  prefs: []
  type: TYPE_TB
  zh: '|  | **VSwitch 2** | **VSwitch 3** |'
- en: '| **Name:** | k8s-2 | k8s-3 |'
  id: totrans-361
  prefs: []
  type: TYPE_TB
  zh: '| **名称：** | k8s-2 | k8s-3 |'
- en: '| **Zone:** | Beijing Zone B | Beijing Zone E |'
  id: totrans-362
  prefs: []
  type: TYPE_TB
  zh: '| **区域：** | 北京B区 | 北京E区 |'
- en: '| **IPv4 CIDR Block:** | 10.20.0.0/16 | 10.30.0.0/16 |'
  id: totrans-363
  prefs: []
  type: TYPE_TB
  zh: '| **IPv4 CIDR块：** | 10.20.0.0/16 | 10.30.0.0/16 |'
- en: Click OK to create your VPC and VSwitches.
  id: totrans-364
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“确定”创建您的VPC和VSwitches。
- en: Open the Aliyun Web console on your web browser ([https://cs.console.aliyun.com](https://cs.console.aliyun.com).).
  id: totrans-365
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的Web浏览器上打开阿里云Web控制台([https://cs.console.aliyun.com](https://cs.console.aliyun.com)。)。
- en: Click on Create Kubernetes Cluster.
  id: totrans-366
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“创建Kubernetes集群”。
- en: Select Standard Managed Cluster.
  id: totrans-367
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择标准托管集群。
- en: Click on the Multi-AZ Kubernetes tab, give your cluster a name, and select the
    same region that you used to create your VPCs and VSwitches.
  id: totrans-368
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“多可用区Kubernetes”选项卡，为您的集群命名，并选择与创建VPC和VSwitches时相同的区域。
- en: 'If you have selected the same region, the VPC dropdown will be populated with `k8s-devops-cookbook-vpc`.
    Now, select all three VSwitches that we''ve created:'
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您选择了相同的区域，VPC下拉菜单将显示为`k8s-devops-cookbook-vpc`。现在，选择我们创建的所有三个VSwitches：
- en: '![](assets/63922633-60f0-438c-9ec7-268c8e4a5d7a.png)'
  id: totrans-370
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/63922633-60f0-438c-9ec7-268c8e4a5d7a.png)'
- en: Set the instance types for the Master node configuration in each zone.
  id: totrans-371
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在每个区域的Master节点配置中设置实例类型。
- en: Set the instance type for the Worker node configuration in each zone and the
    number of nodes in every zone to `3`. Otherwise, use the defaults.
  id: totrans-372
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在每个区域的Worker节点配置中设置实例类型，并将每个区域的节点数设置为`3`。否则，请使用默认设置。
- en: Select the Kubernetes version (`1.12.6-aliyun.1`, at the time of writing).
  id: totrans-373
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择Kubernetes版本（`1.12.6-aliyun.1`，在撰写时）。
- en: 'Select Key Pair Name from the drop-down menu, or create one by clicking Create
    a new key pair:'
  id: totrans-374
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉菜单中选择“密钥对名称”，或者点击“创建新密钥对”来创建一个：
- en: '![](assets/c4c99701-34e6-4578-ba6e-6cc294d78b35.png)'
  id: totrans-375
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/c4c99701-34e6-4578-ba6e-6cc294d78b35.png)'
- en: 'Alibaba offers two CNI options: Flannel and Terway. The difference is explained
    in the *There''s more…* section of this recipe. Leave the default network options
    using `Flannel`. The default parameters support up to 512 servers in the cluster.'
  id: totrans-376
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 阿里巴巴提供两种CNI选项：Flannel和Terway。区别在本食谱的*更多内容…*部分有解释。使用`Flannel`保留默认网络选项。默认参数支持集群中最多512台服务器。
- en: Monitoring and logging will be explained in [Chapter 8](4d910303-e648-4ec0-9a2d-99d553e1a641.xhtml), *Observability
    and Monitoring on Kubernetes*, and [Chapter 10](d76d00a0-541f-4395-92dc-1d6970e31ef2.xhtml),
    *Logging on Kubernetes*. Therefore, this step is optional. Check the `Install
    cloud monitoring plug-in on your ECS` and `Using Log Service` options to enable
    monitoring and logging.
  id: totrans-377
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 监控和日志记录将在[第8章](4d910303-e648-4ec0-9a2d-99d553e1a641.xhtml) *Kubernetes上的可观察性和监控*和[第10章](d76d00a0-541f-4395-92dc-1d6970e31ef2.xhtml)
    *Kubernetes上的日志记录*中进行解释。因此，此步骤是可选的。勾选“在您的ECS上安装云监控插件”和“使用日志服务”选项以启用监控和日志记录。
- en: Now, click on Create to provision your Multi-AZ Kubernetes cluster. This step
    may take 15-20 minutes to complete.
  id: totrans-378
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，点击“创建”以配置您的多可用区Kubernetes集群。此步骤可能需要15-20分钟才能完成。
- en: Connecting to Alibaba Container Service clusters
  id: totrans-379
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接到阿里巴巴容器服务集群
- en: 'To get access to your cluster on Alibaba Cloud, you need to follow these steps:'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 要访问阿里巴巴云上的集群，您需要按照以下步骤进行：
- en: 'To get the cluster''s credentials, go to the Clusters menu and click on the cluster
    name you want to access:'
  id: totrans-381
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要获取集群的凭据，请转到“集群”菜单，然后单击要访问的“集群名称”：
- en: '![](assets/dd1791c1-c581-4109-8292-a3f4541dd025.png)'
  id: totrans-382
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/dd1791c1-c581-4109-8292-a3f4541dd025.png)'
- en: 'Copy the content displayed in the KubeConfig tab to your local machine''s `$HOME/.kube/config` file:'
  id: totrans-383
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制KubeConfig选项卡中显示的内容到您本地机器的`$HOME/.kube/config`文件中：
- en: '![](assets/d48997ed-5c67-4ccb-b8ac-b01612fe45af.png)'
  id: totrans-384
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/d48997ed-5c67-4ccb-b8ac-b01612fe45af.png)'
- en: 'Verify your Kubernetes cluster:'
  id: totrans-385
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证您的Kubernetes集群：
- en: '[PRE65]'
  id: totrans-386
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: As an alternative, see the *Viewing the Kubernetes Dashboard* instructions under
    the *There's more...* section to manage your cluster.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 作为替代方案，请参阅*查看Kubernetes仪表板*部分下的说明，以管理您的集群。
- en: How it works…
  id: totrans-388
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: This recipe showed you how to provision a managed Kubernetes cluster on Alibaba
    Cloud using a cluster template.
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱向您展示了如何使用集群模板在阿里巴巴云上配置托管的Kubernetes集群。
- en: 'Under the Container Service menu, Alibaba Cloud provides a few Kubernetes cluster,
    where you are offered seven cluster templates. We used the Standard Managed Cluster
    here. This option lets you manage the worker nodes only and saves you the cost
    of resources and management for the master nodes:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 在容器服务菜单下，阿里巴巴云提供了一些Kubernetes集群，其中提供了七个集群模板。我们在这里使用了标准托管集群。此选项只允许您管理工作节点，并为您节省了主节点的资源和管理成本：
- en: '![](assets/4509b205-b24a-41dc-9263-877047ddcc67.png)'
  id: totrans-391
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/4509b205-b24a-41dc-9263-877047ddcc67.png)'
- en: By default, accounts support up to 20 clusters and 40 nodes in each cluster.
    You can request a quota increase by submitting a support ticket.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，帐户支持最多20个集群和每个集群40个节点。您可以通过提交支持工单来请求配额增加。
- en: There's more…
  id: totrans-393
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'As an alternative way of using the Alibaba Cloud console, you can use REST
    API calls through `aliyuncli` to create the ECS instances and your cluster. Follow
    these steps to do so:'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 作为使用阿里巴巴云控制台的替代方法，您可以通过`aliyuncli`使用REST API调用来创建ECS实例和您的集群。按照以下步骤操作：
- en: After you've configured your cluster options on your Alibaba Cloud console,
    click on Generate API request Parameters right under the Create button to generate
    POST request body content to be used with the `aliyun` CLI.
  id: totrans-395
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在阿里巴巴云控制台上配置了集群选项后，点击“创建”按钮下方的“生成API请求参数”以生成用于`aliyun` CLI的POST请求主体内容。
- en: Save the content in a file. In our case, this file is called `cscreate.json`.
  id: totrans-396
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将内容保存到文件中。在我们的案例中，这个文件被称为`cscreate.json`。
- en: For an explanation of the additional parameters listed in this section, please
    refer to the *Create a Kubernetes* section at [https://www.alibabacloud.com/help/doc-detail/87525.htm](https://www.alibabacloud.com/help/doc-detail/87525.htm).
  id: totrans-397
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 有关本节中列出的其他参数的解释，请参阅[https://www.alibabacloud.com/help/doc-detail/87525.htm](https://www.alibabacloud.com/help/doc-detail/87525.htm)中的*创建Kubernetes*部分。
- en: 'Use the following command to create your cluster:'
  id: totrans-398
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令创建您的集群：
- en: '[PRE66]'
  id: totrans-399
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'The Alibaba Cloud Container Service provides two network plugin options for
    their Kubernetes clusters: Terway and Flannel.'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 阿里巴巴云容器服务为其Kubernetes集群提供了两种网络插件选项：Terway和Flannel。
- en: Flannel is based on the community Flannel CNI plugin. Flannel is a very common
    and stable networking plugin that provides basic networking functionality. It
    is the recommended option for most use cases, except it does not support the Kubernetes
    NetworkPolicy. Terway is a network plugin developed by Alibaba Cloud CS. It is
    fully compatible with Flannel. Terway can define access policies between containers
    based on the Kubernetes NetworkPolicy. Terway also supports bandwidth limiting
    for containers.
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: Flannel基于社区Flannel CNI插件。Flannel是一个非常常见和稳定的网络插件，提供基本的网络功能。除了不支持Kubernetes NetworkPolicy之外，它是大多数用例的推荐选项。Terway是阿里巴巴云CS开发的网络插件。它与Flannel完全兼容。Terway可以根据Kubernetes
    NetworkPolicy定义容器之间的访问策略。Terway还支持对容器进行带宽限制。
- en: Configuring and managing Kubernetes clusters with Rancher
  id: totrans-402
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Rancher配置和管理Kubernetes集群
- en: Rancher is a container management platform with the flexibility to create Kubernetes
    clusters with **Rancher Kubernetes Engine** (**RKE**) or cloud-based Kubernetes
    services, such as GKE, AKS, and EKS, which we discussed in the previous recipes.
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: Rancher是一个容器管理平台，具有使用**Rancher Kubernetes Engine**（**RKE**）或基于云的Kubernetes服务（如GKE、AKS和EKS）创建Kubernetes集群的灵活性，这些我们在前面的章节中讨论过。
- en: In this section, we will cover recipes for configuring Rancher so that we can
    deploy and manage Kubernetes services.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍配置Rancher的方法，以便部署和管理Kubernetes服务。
- en: Getting ready
  id: totrans-405
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Rancher can be installed on Ubuntu, RHEL/CentOS, RancherOS, or even on Windows
    Server. You can bring up Rancher Server in a high availability configuration or
    a single node. Refer to the *See also...* section for links to the alternative
    installation instructions. In this recipe, we will run Rancher on a single node.
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: Rancher可以安装在Ubuntu、RHEL/CentOS、RancherOS甚至Windows Server上。您可以在高可用配置或单节点中启动Rancher服务器。请参考*另请参阅...*部分，获取替代安装说明的链接。在本教程中，我们将在单个节点上运行Rancher。
- en: How to do it…
  id: totrans-407
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'This section will take you through how to configure and manage Kubernetes clusters
    with Rancher. To that end, this section is further divided into the following
    subsections to make this process easier:'
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将带您了解如何使用Rancher配置和管理Kubernetes集群。为此，本节进一步分为以下子节，以使此过程更加简单：
- en: Installing Rancher Server
  id: totrans-409
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装Rancher服务器
- en: Deploying a Kubernetes cluster
  id: totrans-410
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署Kubernetes集群
- en: Importing an existing cluster
  id: totrans-411
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入现有集群
- en: Enabling cluster and node providers
  id: totrans-412
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启用集群和节点提供程序
- en: Installing Rancher Server
  id: totrans-413
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装Rancher服务器
- en: 'Follow these steps to install Rancher Server:'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤安装Rancher服务器：
- en: 'Install a supported version of Docker. You can skip this step if you have Docker
    installed already:'
  id: totrans-415
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装支持的Docker版本。如果您已经安装了Docker，则可以跳过此步骤：
- en: '[PRE67]'
  id: totrans-416
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Add a user to a Docker group:'
  id: totrans-417
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将用户添加到Docker组：
- en: '[PRE68]'
  id: totrans-418
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'To install Rancher Server, run the following command:'
  id: totrans-419
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要安装Rancher服务器，请运行以下命令：
- en: '[PRE69]'
  id: totrans-420
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: Open a browser window and go to `https://localhost`. Replace `localhost` with
    your host's IP if necessary.
  id: totrans-421
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器窗口，转到`https://localhost`。如有必要，请将`localhost`替换为您主机的IP。
- en: Set a new password and click on Continue.
  id: totrans-422
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置新密码，然后单击继续。
- en: Set the public IP address of Rancher server and click on Save URL. This IP needs
    to be externally accessible from your clusters.
  id: totrans-423
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置Rancher服务器的公共IP地址，并单击保存URL。这个IP地址需要从您的集群外部访问。
- en: Deploying a Kubernetes cluster
  id: totrans-424
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 部署Kubernetes集群
- en: 'To deploy a new cluster, you need to follow these steps:'
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 要部署一个新的集群，您需要按照以下步骤进行：
- en: Click on Add Cluster.
  id: totrans-426
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击添加集群。
- en: 'Choose a provider. In our example, we will use GKE. Some settings for other
    providers might be slightly different:'
  id: totrans-427
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择提供程序。在我们的示例中，我们将使用GKE。其他提供程序的一些设置可能略有不同：
- en: '![](assets/fd8b3f2f-0c40-49ed-8c94-88b35db3b5cd.png)'
  id: totrans-428
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/fd8b3f2f-0c40-49ed-8c94-88b35db3b5cd.png)'
- en: Enter a cluster name.
  id: totrans-429
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入集群名称。
- en: If you have your GCP service account JSON file that we saved previously, skip
    to *step 10*.
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有我们之前保存的GCP服务帐户JSON文件，请跳至*步骤10*。
- en: From the GCP navigation menu, go to IAM and click on the Service accounts link.
  id: totrans-431
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从GCP导航菜单中，转到IAM，然后单击服务帐户链接。
- en: Click on Create Service Account.
  id: totrans-432
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击创建服务帐户。
- en: Enter a service account name and click Create.
  id: totrans-433
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入服务帐户名称，然后单击创建。
- en: Add the required minimum permissions; that is, Compute Viewer, Viewer, Kubernetes
    Engine Admin, and Service Account User, and click Continue.
  id: totrans-434
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加所需的最低权限；即，Compute Viewer、Viewer、Kubernetes Engine Admin和Service Account User，然后单击继续。
- en: Click on Create Key. Use JSON as the key type in order to save your service
    account.
  id: totrans-435
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击创建密钥。使用JSON作为密钥类型，以保存您的服务帐户。
- en: On the Rancher UI, click on Read from a file and load the service account JSON
    file you saved previously.
  id: totrans-436
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Rancher UI上，单击从文件读取，并加载您之前保存的服务帐户JSON文件。
- en: 'Customize the Cluster Options as needed; otherwise, use the default settings
    and click on Create to deploy your Kubernetes cluster:'
  id: totrans-437
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据需要自定义集群选项；否则，使用默认设置，然后单击创建以部署您的Kubernetes集群：
- en: '![](assets/636bbafa-332b-4915-b95b-29b298f6cd68.png)'
  id: totrans-438
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/636bbafa-332b-4915-b95b-29b298f6cd68.png)'
- en: Your cluster will be listed and ready to be managed immediately on your Rancher
    dashboard.
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 您的集群将被列出，并立即可以在Rancher仪表板上进行管理。
- en: Importing an existing cluster
  id: totrans-440
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 导入现有集群
- en: 'To import an existing cluster, you need to follow these steps:'
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 要导入现有集群，您需要按照以下步骤进行：
- en: Click on Add Cluster
  id: totrans-442
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击添加集群
- en: 'Click on Import:'
  id: totrans-443
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击导入：
- en: '![](assets/23165978-0c4b-4a3a-9902-7dcee75cb117.png)'
  id: totrans-444
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/23165978-0c4b-4a3a-9902-7dcee75cb117.png)'
- en: Enter a cluster name and click on Create.
  id: totrans-445
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入集群名称，然后单击“创建”。
- en: 'Follow the instructions shown and copy and run the `kubectl` command displayed
    on the screen to an existing Kubernetes cluster. This command will look similar
    to the following if you are running with an untrusted/self-signed SSL certificate:'
  id: totrans-446
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照显示的说明，复制并运行显示在屏幕上的`kubectl`命令到现有的Kubernetes集群。如果您使用的是不受信任/自签名的SSL证书，则此命令看起来类似于以下内容：
- en: '![](assets/e0f4937e-352f-4b2f-8113-6765b3960efe.png)'
  id: totrans-447
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/e0f4937e-352f-4b2f-8113-6765b3960efe.png)'
- en: 'By clicking on Done, your cluster will be listed and ready to manage immediately
    on your Rancher dashboard:'
  id: totrans-448
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“完成”后，您的集群将被列出，并且可以立即在Rancher仪表板上进行管理：
- en: '![](assets/b72b4d19-a180-4661-85f2-66626655ab8f.png)'
  id: totrans-449
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/b72b4d19-a180-4661-85f2-66626655ab8f.png)'
- en: The last step may take a minute to complete. Eventually, the state of your cluster
    will turn from Pending to Active when it is ready.
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一步可能需要一分钟的时间来完成。最终，当准备就绪时，您的集群状态将从待定变为活动。
- en: Enabling cluster and node providers
  id: totrans-451
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 启用集群和节点提供者
- en: To be able to support multiple providers, Rancher uses cluster and node drivers.
    If you don't see your provider on the list, then it is most likely not enabled.
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: 为了支持多个提供者，Rancher使用集群和节点驱动程序。如果您在列表中找不到您的提供者，则很可能是未启用。
- en: 'To enable additional providers, follow these steps:'
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用其他提供者，请按照以下步骤操作：
- en: From Tools, click on Drivers.
  id: totrans-454
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从“工具”中，单击“驱动程序”。
- en: 'Find your provider on the list and click Activate:'
  id: totrans-455
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在列表中找到您的提供者，然后单击“激活”：
- en: '![](assets/756d1cff-2dc4-43ad-b047-d6a75df90f51.png)'
  id: totrans-456
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/756d1cff-2dc4-43ad-b047-d6a75df90f51.png)'
- en: From the same page, you can also deactivate the providers you don't intend to
    use.
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 从同一页，您还可以停用您不打算使用的提供者。
- en: How it works…
  id: totrans-458
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: This recipe showed you how to quickly run Rancher Server to manage your Kubernetes
    clusters.
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 这个教程向您展示了如何快速运行Rancher服务器来管理您的Kubernetes集群。
- en: In *step 1*, we used a single node installation using a default self-signed
    certificate method. For security purposes, SSL is required to interact with the
    clusters. Therefore, a certificate is required.
  id: totrans-460
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤1*中，我们使用了默认的自签名证书方法进行单节点安装。出于安全目的，与集群交互需要SSL。因此，需要证书。
- en: 'If you prefer to use your own certificate signed by a recognized CA instead,
    you can use the following command and provide the path to your certificates to
    mount them in your container by replacing the `FULLCHAIN.pem` and `PRIVATEKEY.pem` files
    with your signed certificates:'
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您更喜欢使用由认可的CA签名的自己的证书，可以使用以下命令，并提供路径以将它们挂载到容器中，通过用您的签名证书替换`FULLCHAIN.pem`和`PRIVATEKEY.pem`文件：
- en: '[PRE70]'
  id: totrans-462
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: Using a recognized certificate will eliminate the security warning on the login
    page.
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: 使用认可的证书将消除登录页面上的安全警告。
- en: There's more…
  id: totrans-464
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'It is also useful to have knowledge of the following information:'
  id: totrans-465
  prefs: []
  type: TYPE_NORMAL
  zh: 还有以下信息也很有用：
- en: Bind mounting a host volume to keep data
  id: totrans-466
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绑定挂载主机卷以保留数据
- en: Keeping user volumes persistent
  id: totrans-467
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 保持用户卷持久
- en: Keeping data persistent on a host volume
  id: totrans-468
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在主机卷上保持数据持久
- en: Running Rancher on the same Kubernetes nodes
  id: totrans-469
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在相同的Kubernetes节点上运行Rancher
- en: Bind mounting a host volume to keep data
  id: totrans-470
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 绑定挂载主机卷以保留数据
- en: When using the single node installation?, the persistent data is kept on the `/var/lib/rancher` path
    in the container.
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用单节点安装时，持久数据保存在容器中的`/var/lib/rancher`路径上。
- en: 'To keep data on the host, you can bind mount a host volume to a location using
    the following command:'
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: 要在主机上保留数据，可以使用以下命令将主机卷绑定到位置：
- en: '[PRE71]'
  id: totrans-473
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: Bind mounts have limited functionality compared to volumes. When Rancher is
    started using the bind mount, a directory on the host machine will be mounted
    to the specified directory in the container.
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 与卷相比，绑定挂载具有有限的功能。当使用绑定挂载启动Rancher时，主机上的目录将被挂载到容器中的指定目录。
- en: Keeping user volumes persistent
  id: totrans-475
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 保持用户卷持久
- en: When using RancherOS, only specific directories keep the data defined by the `user-volumes` parameter
    persistent.
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用RancherOS时，只有特定目录才能使`user-volumes`参数定义的数据持久。
- en: 'To add additional persistent `user-volumes`, for example, add the `/var/openebs` directory:'
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: 要添加额外的持久`user-volumes`，例如，添加`/var/openebs`目录：
- en: '[PRE72]'
  id: totrans-478
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: After rebooting, data in the specified directories will be persistent.
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: 重新启动后，指定目录中的数据将是持久的。
- en: Running Rancher on the same Kubernetes nodes
  id: totrans-480
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在相同的Kubernetes节点上运行Rancher
- en: 'To add the node where you run Rancher Server on a cluster, replace the default
    ports `-p 80:80 -p 443:443` as follows and use the following command to start
    Rancher:'
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: 要将运行Rancher服务器的节点添加到集群中，请将默认端口`-p 80:80 -p 443:443`替换为以下内容，并使用以下命令启动Rancher：
- en: '[PRE73]'
  id: totrans-482
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: In this case, Rancher Server will be accessible through `https://localhost:8443`
    instead of the standard `443` port.
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，Rancher服务器将通过`https://localhost:8443`而不是标准的`443`端口访问。
- en: See also
  id: totrans-484
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: The Rancher 2.x Documentation: [https://rancher.com/docs/rancher/v2.x/en/](https://rancher.com/docs/rancher/v2.x/en/)
  id: totrans-485
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Rancher 2.x文档：[https://rancher.com/docs/rancher/v2.x/en/](https://rancher.com/docs/rancher/v2.x/en/)
- en: K3s, a lightweight Kubernetes from Rancher Labs: [https://k3s.io/](https://k3s.io/)
  id: totrans-486
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: K3s，来自Rancher Labs的轻量级Kubernetes：[https://k3s.io/](https://k3s.io/)
- en: Rio, an application deployment engine for Kubernetes from Rancher Labs: [https://rio.io/](https://rio.io/)
  id: totrans-487
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Rio，来自Rancher Labs的Kubernetes应用部署引擎：[https://rio.io/](https://rio.io/)
- en: Configuring Red Hat OpenShift
  id: totrans-488
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置Red Hat OpenShift
- en: In this recipe, we will learn how to deploy Red Hat OpenShift on AWS, bare-metal,
    or VMware vSphere VMs.
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，我们将学习如何在AWS、裸金属或VMware vSphere VM上部署Red Hat OpenShift。
- en: The steps in the *Provisioning an OpenShift cluster recipe *can be applied to
    deploy OpenShift on either VMs running on a virtualized environment or bare-metal
    servers.
  id: totrans-490
  prefs: []
  type: TYPE_NORMAL
  zh: '*部署OpenShift集群教程*中的步骤可以应用于在虚拟化环境上运行的VM或裸金属服务器上部署OpenShift。'
- en: Getting ready
  id: totrans-491
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: All the operations mentioned here require a Red Hat account with active Red
    Hat Enterprise Linux and OpenShift Container Platform subscriptions. If you don't
    have one already, go to [https://access.redhat.com](https://access.redhat.com) and
    create an account.
  id: totrans-492
  prefs: []
  type: TYPE_NORMAL
  zh: 这里提到的所有操作都需要具有活动Red Hat Enterprise Linux和OpenShift Container Platform订阅的Red
    Hat帐户。如果您还没有，请转到[https://access.redhat.com](https://access.redhat.com)并创建一个帐户。
- en: When you deploy on VMs, make sure to plan that the zones you create on Kubernetes
    nodes are actually physically located on separate hypervisor nodes.
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
  zh: 在部署VM时，请确保计划在Kubernetes节点上创建的区域实际上位于单独的hypervisor节点上。
- en: For this recipe, we need to have a minimum of six nodes with Red Hat Enterprise
    CoreOS installed on them. These nodes can be either bare-metal, VMs, or a mix
    of bare-metal and VMs.
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个教程，我们需要至少有六个节点，上面安装了Red Hat Enterprise CoreOS。这些节点可以是裸金属、VM或裸金属和VM的混合体。
- en: How to do it…
  id: totrans-495
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'This section will take you through how to configure Red Hat OpenShift. To that
    end, this section is further divided into the following subsections to make this
    process easier:'
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将带您了解如何配置Red Hat OpenShift。为此，本节进一步分为以下子节，以使此过程更加简单：
- en: Downloading OpenShift binaries
  id: totrans-497
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下载OpenShift二进制文件
- en: Provisioning an OpenShift cluster
  id: totrans-498
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署OpenShift集群
- en: Connecting to OpenShift clusters
  id: totrans-499
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接到OpenShift集群
- en: Downloading OpenShift binaries
  id: totrans-500
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 下载OpenShift二进制文件
- en: 'Make sure you are on the Terminal of your first master and that you have an
    account with root access, or you are running as a superuser. Follow these steps:'
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: 确保您在第一个主节点的终端上，并且具有 root 访问权限的帐户，或者正在以超级用户身份运行。按照以下步骤操作：
- en: 'Go to [https://cloud.redhat.com/openshift/install](https://cloud.redhat.com/openshift/install) and
    download the latest `OpenShift Installer`:'
  id: totrans-502
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到 [https://cloud.redhat.com/openshift/install](https://cloud.redhat.com/openshift/install)
    并下载最新的 `OpenShift Installer`：
- en: '![](assets/ca4493dd-b52c-4cb7-8575-107a4395153c.png)'
  id: totrans-503
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/ca4493dd-b52c-4cb7-8575-107a4395153c.png)'
- en: 'Extract the installer files on your workstation:'
  id: totrans-504
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的工作站上提取安装程序文件：
- en: '[PRE74]'
  id: totrans-505
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: The preceding command will create a file called `openshift-install` in the same
    folder.
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令将在同一文件夹中创建一个名为 `openshift-install` 的文件。
- en: Provisioning an OpenShift cluster
  id: totrans-507
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置 OpenShift 集群
- en: 'In this recipe, we will use the AWS platform to deploy OpenShift:'
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: 在此教程中，我们将使用 AWS 平台部署 OpenShift：
- en: 'To get your OpenShift cluster up, use the following command:'
  id: totrans-509
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要启动您的 OpenShift 集群，请使用以下命令：
- en: '[PRE75]'
  id: totrans-510
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: Choose `aws` as your platform and enter your `AWS Access Key ID` and `Secret
    Access Key`.
  id: totrans-511
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 `aws` 作为您的平台，并输入您的 `AWS Access Key ID` 和 `Secret Access Key`。
- en: Choose your region. In our example, this is `us-east-1`.
  id: totrans-512
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择您的地区。在我们的示例中，这是 `us-east-1`。
- en: Select a base domain. In our example, this is `k8s.containerized.me`.
  id: totrans-513
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个基础域。在我们的示例中，这是 `k8s.containerized.me`。
- en: Enter a cluster name.
  id: totrans-514
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入一个集群名称。
- en: 'Copy Pull Secret from the Red Hat site and paste it onto the command line:'
  id: totrans-515
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 Red Hat 网站复制 Pull Secret，并将其粘贴到命令行中：
- en: '![](assets/54710f98-e2fe-4123-8fe1-cd372651908f.png)'
  id: totrans-516
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/54710f98-e2fe-4123-8fe1-cd372651908f.png)'
- en: 'After the installation is complete, you will see the console URL and credentials
    for accessing your new cluster, similar to the following:'
  id: totrans-517
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，您将看到控制台 URL 和访问新集群的凭据，类似于以下内容：
- en: '[PRE76]'
  id: totrans-518
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: Switch to the Red Hat site and click on the `Download Command-Line Tools` link
    to download `openshift-client`.
  id: totrans-519
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到 Red Hat 网站，单击 `Download Command-Line Tools` 链接以下载 `openshift-client`。
- en: 'Extract the `openshift-client` files in your workstation:'
  id: totrans-520
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的工作站上提取 `openshift-client` 文件：
- en: '[PRE77]'
  id: totrans-521
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: The preceding command will create the `kubectl` and `oc` files on the same folder
    and move the `oc` binary to PATH.
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令将在同一文件夹中创建 `kubectl` 和 `oc` 文件，并将 `oc` 二进制文件移动到 PATH。
- en: Connecting to OpenShift clusters
  id: totrans-523
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接到 OpenShift 集群
- en: 'To connect to OpenShift clusters, follow these steps:'
  id: totrans-524
  prefs: []
  type: TYPE_NORMAL
  zh: 要连接到 OpenShift 集群，请按照以下步骤操作：
- en: 'To get access to your OpenShift cluster, use the following command:'
  id: totrans-525
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要访问您的 OpenShift 集群，请使用以下命令：
- en: '[PRE78]'
  id: totrans-526
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'Log in to your OpenShift cluster after replacing `password` and `cluster address`:'
  id: totrans-527
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 替换 `password` 和 `cluster address` 后登录到您的 OpenShift 集群：
- en: '[PRE79]'
  id: totrans-528
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: If you prefer to use the web console instead, open the web console URL address
    from the *Provisioning an OpenShift cluster* recipe, in *step 7*.
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您更喜欢使用 Web 控制台，可以在 *配置 OpenShift 集群* 教程中的步骤 7 中打开 Web 控制台 URL 地址。
- en: How it works…
  id: totrans-530
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: This recipe showed you how to quickly deploy an OpenShift cluster on AWS.
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
  zh: 此教程向您展示了如何在 AWS 上快速部署 OpenShift 集群。
- en: In *step 1*, we created a cluster using the default configuration of the installer-provisioned
    infrastructure.
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *步骤 1* 中，我们使用安装程序提供的基础设施的默认配置创建了一个集群。
- en: The installer asked a series of questions regarding user information and used
    mostly default values for other configuration options. These defaults can be edited
    and customized if needed using the `install-config.yaml` file.
  id: totrans-533
  prefs: []
  type: TYPE_NORMAL
  zh: 安装程序询问了一系列关于用户信息的问题，并且大多数其他配置选项都使用了默认值。如果需要，这些默认值可以通过 `install-config.yaml`
    文件进行编辑和自定义。
- en: 'To see the defaults that were used for the deployment, let''s create an `install-config.yaml` file
    and view it:'
  id: totrans-534
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看部署时使用的默认值，让我们创建一个 `install-config.yaml` 文件并查看它：
- en: '[PRE80]'
  id: totrans-535
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'As you can see from the following output, the file''s default configuration
    creates a cluster consisting of three master and three worker nodes:'
  id: totrans-536
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从以下输出中所见，文件的默认配置创建了一个由三个主节点和三个工作节点组成的集群：
- en: '[PRE81]'
  id: totrans-537
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: Edit `install-config.yaml` as needed. Next time you create the cluster, new
    parameters will be used instead.
  id: totrans-538
  prefs: []
  type: TYPE_NORMAL
  zh: 根据需要编辑`install-config.yaml`。下次创建集群时，将使用新参数。
- en: There's more…
  id: totrans-539
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'It is also useful to have knowledge of the following information:'
  id: totrans-540
  prefs: []
  type: TYPE_NORMAL
  zh: 还有以下信息也是有用的：
- en: Deleting your cluster
  id: totrans-541
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除您的集群
- en: Deleting your cluster
  id: totrans-542
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 删除您的集群
- en: 'To delete your cluster, use the following command:'
  id: totrans-543
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除您的集群，请使用以下命令：
- en: '[PRE82]'
  id: totrans-544
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: This process will take a few minutes and, when finished, you will get a confirmation
    message.
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
  zh: 此过程将需要几分钟时间，完成后将收到确认消息。
- en: See also
  id: totrans-546
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: The OpenShift Container Platform 4.3 Documentation: [https://docs.openshift.com/container-platform/4.3/welcome/index.html](https://docs.openshift.com/container-platform/4.3/welcome/index.html)
  id: totrans-547
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenShift容器平台4.3文档：[https://docs.openshift.com/container-platform/4.3/welcome/index.html](https://docs.openshift.com/container-platform/4.3/welcome/index.html)
- en: Configuring a Kubernetes cluster using Ansible
  id: totrans-548
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Ansible配置Kubernetes集群
- en: Powerful IT automation engines such as Ansible can be used to automate pretty
    much any day-to-day IT task, including the deployment of Kubernetes clusters on
    bare-metal clusters. In this section, we will learn how to deploy a simple Kubernetes
    cluster using Ansible playbooks.
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
  zh: 强大的IT自动化引擎，如Ansible，可用于自动化几乎任何日常IT任务，包括在裸机集群上部署Kubernetes集群。在本节中，我们将学习如何使用Ansible
    playbook部署一个简单的Kubernetes集群。
- en: Getting ready
  id: totrans-550
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this recipe, we will use an Ansible playbook. The examples that will be used
    in these recipes are accessible through the `k8sdevopscookbook` GitHub repository.
  id: totrans-551
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将使用一个Ansible playbook。这些食谱中将使用的示例可通过`k8sdevopscookbook` GitHub存储库访问。
- en: 'Before you start executing the commands in this section''s recipes, clone the
    Ansible playbook examples using the following command:'
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行本节食谱中的命令之前，请使用以下命令克隆Ansible playbook示例：
- en: '[PRE83]'
  id: totrans-553
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: You will find the examples stored under the `k8sdevopscookbook/src` directory.
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在`k8sdevopscookbook/src`目录下找到示例存储。
- en: How to do it…
  id: totrans-555
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'This section will take you through how to configure a Kubernetes cluster using
    Ansible. To that end, this section is further divided into the following subsections
    to make this process easier:'
  id: totrans-556
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将带您了解如何使用Ansible配置Kubernetes集群。为此，本节进一步分为以下子节，以使此过程更加简单：
- en: Installing Ansible
  id: totrans-557
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装Ansible
- en: Provisioning a Kubernetes cluster using an Ansible playbook
  id: totrans-558
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Ansible playbook提供Kubernetes集群
- en: Connecting to the Kubernetes cluster
  id: totrans-559
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接到Kubernetes集群
- en: Installing Ansible
  id: totrans-560
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装Ansible
- en: 'In order to provision a Kubernetes cluster using an Ansible playbook, follow
    these steps:'
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用Ansible playbook提供Kubernetes集群，请按照以下步骤进行：
- en: 'To install Ansible on your Linux workstation, first, we need to add the necessary
    repositories:'
  id: totrans-562
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要在Linux工作站上安装Ansible，首先需要添加必要的存储库：
- en: '[PRE84]'
  id: totrans-563
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'Install Ansible using the following command:'
  id: totrans-564
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令安装Ansible：
- en: '[PRE85]'
  id: totrans-565
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: 'Verify its version and make sure Ansible is installed:'
  id: totrans-566
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证其版本并确保已安装Ansible：
- en: '[PRE86]'
  id: totrans-567
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: At the time this recipe was written, the latest Ansible version was `2.9.4`.
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: 在撰写本食谱时，最新的Ansible版本是`2.9.4`。
- en: Provisioning a Kubernetes cluster using an Ansible playbook
  id: totrans-569
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用Ansible playbook提供Kubernetes集群
- en: 'In order to provision a Kubernetes cluster using an Ansible playbook, follow
    these steps:'
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用Ansible playbook提供Kubernetes集群，请按照以下步骤进行：
- en: 'Edit the `hosts.ini` file and replace the master and node IP addresses with
    your node IPs where you want Kubernetes to be configured:'
  id: totrans-571
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑`hosts.ini`文件，并用您想要配置Kubernetes的节点IP地址替换主节点和节点IP地址：
- en: '[PRE87]'
  id: totrans-572
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: 'The `hosts.ini` file should look as follows:'
  id: totrans-573
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`hosts.ini`文件应如下所示：'
- en: '[PRE88]'
  id: totrans-574
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: 'Edit the `groups_vars/all.yml` file to customize your configuration. The following
    is an example of how to do this:'
  id: totrans-575
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑`groups_vars/all.yml`文件以自定义您的配置。以下是如何执行此操作的示例：
- en: '[PRE89]'
  id: totrans-576
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: 'Run the `site.yaml` playbook to create your cluster:'
  id: totrans-577
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行`site.yaml` playbook来创建您的集群：
- en: '[PRE90]'
  id: totrans-578
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: Your cluster will be deployed based on your configuration.
  id: totrans-579
  prefs: []
  type: TYPE_NORMAL
  zh: 您的集群将根据您的配置部署。
- en: Connecting to the Kubernetes cluster
  id: totrans-580
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接到Kubernetes集群
- en: 'To get access to your Kubernetes cluster, you need to follow these steps:'
  id: totrans-581
  prefs: []
  type: TYPE_NORMAL
  zh: 要访问您的Kubernetes集群，您需要按照以下步骤进行操作：
- en: 'Copy the configuration file from the `master1` node:'
  id: totrans-582
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`master1`节点复制配置文件：
- en: '[PRE91]'
  id: totrans-583
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: Now, use `kubectl` to manage your cluster.
  id: totrans-584
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，使用`kubectl`来管理您的集群。
- en: See also
  id: totrans-585
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: The Ansible module for working with Kubernetes: [https://docs.ansible.com/ansible/latest/modules/k8s_module.html](https://docs.ansible.com/ansible/latest/modules/k8s_module.html)
  id: totrans-586
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于与Kubernetes一起工作的Ansible模块：[https://docs.ansible.com/ansible/latest/modules/k8s_module.html](https://docs.ansible.com/ansible/latest/modules/k8s_module.html)
- en: Kubernetes Operators examples using Ansible and the Operator SDK: [https://github.com/operator-framework/operator-sdk/blob/master/doc/ansible/user-guide.md](https://github.com/operator-framework/operator-sdk/blob/master/doc/ansible/user-guide.md)
  id: totrans-587
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Ansible和Operator SDK的Kubernetes运算符示例：[https://github.com/operator-framework/operator-sdk/blob/master/doc/ansible/user-guide.md](https://github.com/operator-framework/operator-sdk/blob/master/doc/ansible/user-guide.md)
- en: Troubleshooting installation issues
  id: totrans-588
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障排除安装问题
- en: Kubernetes consists of many loosely coupled components and APIs. Based on environmental
    differences, you may run into problems where a little bit more attention is required
    to get everything up and running. Fortunately, Kubernetes provides many ways to
    point out problems.
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
  zh: Kubernetes由许多松散耦合的组件和API组成。基于环境的不同，您可能会遇到需要更多关注才能使一切正常运行的问题。幸运的是，Kubernetes提供了许多指出问题的方法。
- en: In this section, we will learn how to get cluster information in order to troubleshoot
    potential issues.
  id: totrans-590
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习如何获取集群信息，以便排除潜在问题。
- en: How to do it…
  id: totrans-591
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何执行…
- en: 'Follow these steps to gather cluster information in order to troubleshoot potential
    issues:'
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤收集集群信息，以便排除潜在问题：
- en: 'Create a file dump of the cluster state called `cluster-state`:'
  id: totrans-593
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建名为`cluster-state`的集群状态文件转储：
- en: '[PRE92]'
  id: totrans-594
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'Display the master and service addresses:'
  id: totrans-595
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示主节点和服务地址：
- en: '[PRE93]'
  id: totrans-596
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: 'Show the resource usage of the `us-west-2.compute.internal` node:'
  id: totrans-597
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示`us-west-2.compute.internal`节点的资源使用情况：
- en: '[PRE94]'
  id: totrans-598
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: 'Mark the `us-west-2.compute.internal` node as unschedulable:'
  id: totrans-599
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`us-west-2.compute.internal`节点标记为不可调度：
- en: '[PRE95]'
  id: totrans-600
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: 'Safely evict all the pods from the `us-west-2.compute.internal` node for maintenance:'
  id: totrans-601
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安全地从`us-west-2.compute.internal`节点中撤出所有的pod以进行维护：
- en: '[PRE96]'
  id: totrans-602
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: 'Mark the `us-west-2.compute.internal` node as schedulable after maintenance:'
  id: totrans-603
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在维护后，将`us-west-2.compute.internal`节点标记为可调度：
- en: '[PRE97]'
  id: totrans-604
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: How it works…
  id: totrans-605
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: This recipe showed you how to quickly troubleshoot common Kubernetes cluster
    issues.
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: 这个教程向您展示了如何快速排除常见的Kubernetes集群问题。
- en: 'In step 1, when the `kubectl cluster-info` command was executed with the `--output-directory`
    parameter, Kubernetes dumped the content of the cluster state under a specified
    folder. You can see the full list using the following command:'
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
  zh: 在第1步中，当使用`kubectl cluster-info`命令执行`--output-directory`参数时，Kubernetes将集群状态的内容转储到指定文件夹下。您可以使用以下命令查看完整列表：
- en: '[PRE98]'
  id: totrans-608
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: In step 4, we marked the node as unavailable using the `kubectl cordon` command.
    Kubernetes has a concept of scheduling applications, meaning that it assigns pods
    to nodes that are available. If you know in advance that an instance on your cluster
    will be terminated or updated, you don't want new pods to be scheduled on that
    specific node. Cordoning means patching the node with `node.Spec.Unschedulable=true`.
    When a node is set as unavailable, no new pods will be scheduled on that node.
  id: totrans-609
  prefs: []
  type: TYPE_NORMAL
  zh: 在第4步中，我们使用`kubectl cordon`命令将节点标记为不可用。Kubernetes有一个调度应用程序的概念，这意味着它会将pod分配给可用的节点。如果您事先知道集群中的实例将被终止或更新，您不希望在特定节点上安排新的pod。
    Cordoning意味着使用`node.Spec.Unschedulable=true`对节点进行修补。当节点设置为不可用时，不会在该节点上安排新的pod。
- en: In step 5, we use, the `kubectl drain` command to evict the existing pods, because
    cordoning alone will not have an impact on the currently scheduled pods. Evict
    APIs take disruption budgets into account. If set by the owner, disruption budgets
    limit the number of pods of a replicated application that are down simultaneously
    from voluntary disruptions. If this isn't supported or set, Evict APIs will simply
    delete the pods on the node after the grace period.
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: 在第5步中，我们使用`kubectl drain`命令驱逐现有的pod，因为仅使用cordoning不会对当前已安排的pod产生影响。驱逐API会考虑中断预算。如果所有者设置了中断预算，中断预算将限制复制应用程序中同时处于自愿中断状态的pod数量。如果不支持或设置了中断预算，驱逐API将在宽限期后简单地删除节点上的pod。
- en: There's more…
  id: totrans-611
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'It is also useful to have knowledge of the following information:'
  id: totrans-612
  prefs: []
  type: TYPE_NORMAL
  zh: 以下信息也很有用：
- en: Setting log levels
  id: totrans-613
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置日志级别
- en: Setting log levels
  id: totrans-614
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置日志级别
- en: When using the `kubectl` command, you can set the output verbosity with the
    `--v` flag, followed by an integer for the log level, which is a number between
    0 and 9\. The general Kubernetes logging conventions and the associated log levels
    are described in the Kubernetes documentation at [https://kubernetes.io/docs/reference/kubectl/cheatsheet/#kubectl-output-verbosity-and-debugging](https://kubernetes.io/docs/reference/kubectl/cheatsheet/#kubectl-output-verbosity-and-debugging).
  id: totrans-615
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用`kubectl`命令时，您可以使用`--v`标志设置输出详细程度，后面跟着日志级别的整数，该整数介于0和9之间。 Kubernetes文档中描述了一般的Kubernetes日志约定和相关的日志级别：[https://kubernetes.io/docs/reference/kubectl/cheatsheet/#kubectl-output-verbosity-and-debugging](https://kubernetes.io/docs/reference/kubectl/cheatsheet/#kubectl-output-verbosity-and-debugging)。
- en: 'It is useful to get the output details in a specific format by adding one of
    the following parameters to your command:'
  id: totrans-616
  prefs: []
  type: TYPE_NORMAL
  zh: 将输出详细信息以特定格式获取是有用的，方法是在命令中添加以下参数之一：
- en: '`-o=wide` is used to get additional information on a resource. An example is
    as follows:'
  id: totrans-617
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-o=wide` 用于获取资源的附加信息。示例如下：'
- en: '[PRE99]'
  id: totrans-618
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: '`-o=yaml` is used to return the output in YAML format. An example is as follows:'
  id: totrans-619
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-o=yaml` 用于以YAML格式返回输出。示例如下：'
- en: '[PRE100]'
  id: totrans-620
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: As you can see, the output of the `-o=yaml` parameter can be used to create
    a manifest file out of an existing resource as well.
  id: totrans-621
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您所看到的，`-o=yaml`参数的输出也可以用来从现有资源创建清单文件。
- en: See also
  id: totrans-622
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: An overview and detailed uses of the kubectl command: [https://kubernetes.io/docs/reference/kubectl/overview/](https://kubernetes.io/docs/reference/kubectl/overview/)
  id: totrans-623
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: kubectl命令的概述和详细用法：[https://kubernetes.io/docs/reference/kubectl/overview/](https://kubernetes.io/docs/reference/kubectl/overview/)
- en: kubectl cheat sheet: [https://kubernetes.io/docs/reference/kubectl/cheatsheet/](https://kubernetes.io/docs/reference/kubectl/cheatsheet/)
  id: totrans-624
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: kubectl速查表：[https://kubernetes.io/docs/reference/kubectl/cheatsheet/](https://kubernetes.io/docs/reference/kubectl/cheatsheet/)
- en: A visual guide on troubleshooting Kubernetes deployments: [https://learnk8s.io/a/troubleshooting-kubernetes.pdf](https://learnk8s.io/a/troubleshooting-kubernetes.pdf)
  id: totrans-625
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kubernetes部署故障排除的可视化指南：[https://learnk8s.io/a/troubleshooting-kubernetes.pdf](https://learnk8s.io/a/troubleshooting-kubernetes.pdf)
- en: K9s – the Kubernetes CLI to manage your clusters in style: [https://github.com/derailed/k9s](https://github.com/derailed/k9s)
  id: totrans-626
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: K9s – 用时尚的 Kubernetes CLI 管理您的集群：[https://github.com/derailed/k9s](https://github.com/derailed/k9s)
